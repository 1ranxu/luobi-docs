# LuoBI

## é¡¹ç›®ä»‹ç»

**BIï¼ˆå•†ä¸šæ™ºèƒ½ï¼‰ï¼š**æ•°æ®å¯è§†åŒ–ï¼ŒæŠ¥è¡¨å¯è§†åŒ–ç³»ç»Ÿ

**ä¸»æµBIï¼š**

- å¸†è½¯BI https://www.finebi.com
- å°é©¬BI https://bi.zhls.qq.com
- PowerBI https://powerbi.microsoft.com/zh-cn 

**ä¼ ç»ŸBIï¼š**

https://chartcube.alipay.com

1. éœ€è¦äººå·¥ä¸Šä¼ æ•°æ®
2. éœ€è¦äººå·¥é€‰æ‹©æ•°æ®çš„è¡Œå’Œåˆ—è¿›è¡Œåˆ†æï¼ˆæ•°æ®åˆ†æå¸ˆï¼‰
3. éœ€è¦äººå·¥é€‰æ‹©å›¾è¡¨ç±»å‹ï¼ˆæ•°æ®åˆ†æå¸ˆï¼‰
4. ç”Ÿæˆå›¾è¡¨ï¼ˆä¿å­˜é…ç½®ï¼‰

**æ™ºèƒ½BIå¹³å°ï¼š**

1. ç”¨æˆ·ï¼ˆæ•°æ®åˆ†æè€…ï¼‰åªéœ€è¦å¯¼å…¥åŸå§‹æ•°æ®ï¼Œè¾“å…¥æƒ³è¦åˆ†æçš„ç›®æ ‡ï¼ˆæ¯”å¦‚â€å¸®æˆ‘åˆ†æä»¥ä¸‹ç½‘ç«™çš„ç”¨æˆ·å¢é•¿è¶‹åŠ¿â€œï¼‰ï¼Œå°±èƒ½åˆ©ç”¨AIè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªç¬¦åˆè¦æ±‚çš„å›¾è¡¨ä»¥åŠç»“è®º
2. ä¸ä¼šæ•°æ®åˆ†æçš„ç”¨æˆ·ï¼Œä¹Ÿèƒ½é€šè¿‡è¾“å…¥ç›®æ ‡å¿«é€Ÿå®Œæˆæ•°æ®åˆ†æï¼Œå¤§å¹…èŠ‚çº¦äººåŠ›æˆæœ¬

## éœ€æ±‚åˆ†æ

1. æ™ºèƒ½åˆ†æï¼šç”¨æˆ·è¾“å…¥ç›®æ ‡ï¼ŒåŸå§‹æ•°æ®å’Œå…¶ä»–å‚æ•°ï¼ˆå¦‚å›¾è¡¨ç±»å‹ï¼‰ï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆå›¾è¡¨å’Œç»“è®º
2. å›¾è¡¨ç®¡ç†
3. å›¾è¡¨ç”Ÿæˆçš„å¼‚æ­¥åŒ–ï¼ˆæ¶ˆæ¯é˜Ÿåˆ— ï¼‰
4. å¯¹æ¥ AI 

## æ¶æ„å›¾

![image-20231030214212882](assets/image-20231030214212882.png)

## æŠ€æœ¯é€‰æ‹©

**å‰ç«¯ï¼š**

- React
- Ant Design Pro
- Umi
- ECharts å¯è§†åŒ–å¼€å‘åº“
- umi openapi ä»£ç ç”Ÿæˆï¼ˆè‡ªåŠ¨ç”Ÿæˆåç«¯è°ƒç”¨ä»£ç ï¼‰

**åç«¯ï¼š**

- Spring Bootï¼ˆä¸‡ç”¨ Java åç«¯é¡¹ç›®æ¨¡æ¿ï¼‰
- MySQL
- MyBatis Plus
- RabbitMQ
- AI èƒ½åŠ›ï¼ˆOpen AI æ¥å£å¼€å‘/ ä½¿ç”¨ç°æˆçš„ AI æ¥å£ï¼‰
- EasyExcelï¼ˆExcel çš„ä¸Šä¼ å’Œæ•°æ®çš„è§£æï¼‰
- Swagger + Knife4j
- Hutool

## è®¡åˆ’

**åˆå§‹åŒ–**

- å‰ç«¯
- åç«¯

**åç«¯**

- æ•°æ®åº“è¡¨è®¾è®¡
- è‡ªåŠ¨ç”Ÿæˆå¢åˆ æ”¹æŸ¥ä»£ç 
- å›¾è¡¨ç®¡ç†
- æ™ºèƒ½å›¾è¡¨åˆ†æ
- ç³»ç»Ÿä¼˜åŒ–

**å‰ç«¯**

- è‡ªåŠ¨ç”Ÿæˆåç«¯è°ƒç”¨ä»£ç 
- ä¿®æ”¹requestErrorConfig

- ç™»å½•æ³¨å†Œé¡µé¢
- æ™ºèƒ½å›¾è¡¨åˆ†æé¡µé¢
- ä¸ªäººå›¾è¡¨é¡µé¢

## åˆå§‹åŒ–

### å‰ç«¯

#### åˆå§‹åŒ–

https://pro.ant.design/

1. åˆ›å»ºé¡¹ç›®

```sh
# ä½¿ç”¨ npmï¼Œ
npm i @ant-design/pro-cli -g
pro create luobi-frontend
```

![image-20231031101557449](assets/image-20231031101557449.png)

2. å®‰è£…ä¾èµ–

```
yarn
```

![image-20231031102623399](assets/image-20231031102623399.png)

3. å»é™¤å›½é™…åŒ–

![image-20231031105510481](assets/image-20231031105510481.png)

[ğŸ› [BUG\] æ‰§è¡Œåˆ é™¤å›½é™…åŒ–å‘½ä»¤æŠ¥é”™ Â· Issue #10452 Â· ant-design/ant-design-pro (github.com)](https://github.com/ant-design/ant-design-pro/issues/10452)

![image-20231031105637111](assets/image-20231031105637111.png)

```sh
yarn add eslint-config-prettier --dev yarn add eslint-plugin-unicorn --dev 
```

![image-20231031105714817](assets/image-20231031105714817.png)

![image-20231031105729743](assets/image-20231031105729743.png)

å†æ¬¡æ‰§è¡Œå»é™¤å›½é™…åŒ–å°±èƒ½æˆåŠŸäº†

![image-20231031105849430](assets/image-20231031105849430.png)

#### ç»“æ„ä»‹ç»

- .huskyï¼šæäº¤ä»£ç æ—¶ï¼Œæ£€æŸ¥æ˜¯å¦è§„èŒƒ
- config
  - config.tsï¼šæ ¸å¿ƒé…ç½®æ–‡ä»¶
  - defaultSettings.tsï¼šä¸»é¡µé¡µé¢çš„æ’ç‰ˆå’Œé¢œè‰²ç­‰è®¾ç½®
  - openapi.jsonï¼šåªæ˜¯ç¤ºä¾‹æ•°æ®ï¼Œæ— ç”¨å¯åˆ é™¤
  - proxy.tsï¼šä»£ç†
  - routes.tsï¼šè·¯ç”±
- mockï¼šæ¨¡æ‹Ÿæ•°æ®ï¼Œæ— ç”¨å¯åˆ é™¤
- public
  - iconsï¼šå›¾æ ‡logoï¼Œæ— ç”¨å¯åˆ é™¤
  - scriptsï¼šä¸çŸ¥é“
  - CNAMEï¼šä¸ç”¨ç®¡
  - favicon.icoï¼šç½‘ç«™å·¦ä¸Šè§’å°å›¾æ ‡ https://www.iconfont.cn
  - logo.svgï¼šæ›¿æ¢æˆè‡ªå·±çš„logohttps://www.iconfont.cn
  - pro_icon.svgï¼šæ— ç”¨åˆ é™¤
- src
  - .umiï¼šå¸¦ç‚¹çš„æ˜¯éšè—æ–‡ä»¶ï¼Œæ¡†æ¶è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä¸ç”¨ç®¡
  - componentsï¼šéœ€è¦å¼€å‘çš„ç»„ä»¶
  - localesï¼šå›½é™…åŒ–ï¼Œæ— ç”¨å¯åˆ é™¤
  - pagesï¼šéœ€è¦å¼€å‘çš„é¡µé¢
    - User
      - Login
        - __snapshots__ï¼šå¤šä½™å¯åˆ é™¤
        - login.test.tsxï¼šå¤šä½™å¯åˆ é™¤
    - TableListï¼šæš‚æ—¶æœªç”¨åˆ°ï¼Œåˆ é™¤
  - services
    - ant-design-proï¼šæœ‰å¾ˆå¤šæ¡†æ¶è‡ªå®šä¹‰çš„å‡½æ•°å’Œç±»å‹ï¼Œä¸ç”¨åˆ ï¼Œå¯èƒ½ä¼šå¼•èµ·è¿é”æ•ˆåº”
    - luobiï¼šæˆ‘ä»¬è‡ªå·±ä½¿ç”¨openapiç”Ÿæˆçš„å‡½æ•°å’Œç±»å‹
    - swaggerï¼šæ— ç”¨å¯åˆ é™¤
  - access.tsï¼šæ§åˆ¶é¡µé¢è®¿é—®
  - app.tsxï¼šæ•´ä¸ªæ¡†æ¶çš„å…¥å£æ–‡ä»¶
  - global.lessï¼šå…¨å±€æ ·å¼
  - global.tsxï¼šå…¨å±€çš„jsæ–‡ä»¶ï¼Œä¸è¦åˆ æ”¹
  - manifest.jsonï¼šå¼€å‘appæˆ–H5ç½‘é¡µæ—¶æŒ‡å®šçš„é…ç½®ï¼šæ¯”å¦‚å£°æ˜é¡¹ç›®çš„åç§°ï¼Œå›¾æ ‡çš„å°ºå¯¸ï¼Œæ‰“åŒ…æ—¶ç”¨ã€‚å¯åˆ 
  - requestErrorConfigï¼šå‰ç«¯å‘è¯·æ±‚çš„ä¸€äº›é…ç½®ï¼Œæ¯”å¦‚è¯·æ±‚å“åº”æ‹¦æˆªå™¨ï¼Œè¯·æ±‚å‰ç¼€
  - service-workers.jsï¼šä¸ºäº†ä¼˜åŒ–ç¦»çº¿H5é¡µé¢çš„ä½“éªŒ
  - typings.d.tsï¼šä¸çŸ¥é“ï¼Œä¸èƒ½åˆ 
- testsï¼šæµ‹è¯•æ–‡ä»¶ï¼Œæ— ç”¨å¯åˆ é™¤
- typesï¼šæ— ç”¨å¯åˆ é™¤
- .editorconfigã€.eslintrc.jsã€.prettierrc.jsï¼šç”¨æ¥ä¿è¯å‰ç«¯ä»£ç è§„èŒƒ
- jest.config.tsï¼šå•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œä¸ç”¨UIæµ‹è¯•å¯åˆ é™¤
- jsconfig.jsonï¼šæ§åˆ¶ä»£ç è¯­æ³•
- README.mdï¼šé¡¹ç›®çš„ä»‹ç»æ–‡æ¡£

#### æ›¿æ¢logo

**favicon.icoï¼š**ç½‘ç«™å·¦ä¸Šè§’å°å›¾æ ‡ https://www.iconfont.cn

![image-20231031205626497](assets/image-20231031205626497.png)

![image-20231031205828170](assets/image-20231031205828170.png)

png è½¬favicon https://www.gaituba.com/favicon

![image-20231031210026473](assets/image-20231031210026473.png)

**logo.svgï¼š**æ›¿æ¢æˆè‡ªå·±çš„logohttps://www.iconfont.cn

![image-20231031205304201](assets/image-20231031205304201.png)

![image-20231031205328579](assets/image-20231031205328579.png)

![image-20231031210249195](assets/image-20231031210249195.png)

#### prettierç¾åŒ–é…ç½®

![image-20231031212517690](assets/image-20231031212517690.png)

#### æ›¿æ¢ç½‘ç«™æ ‡é¢˜

å…¨å±€æ›¿æ¢ Ant Design Pro å’Œ Ant Design

![image-20231031213130067](assets/image-20231031213130067.png)

![image-20231031213338025](assets/image-20231031213338025.png)

#### æ›¿æ¢åº•éƒ¨çš„ç‰ˆæƒä¿¡æ¯

ç›´æ¥æœç´¢åº•éƒ¨å…³é”®å­—ï¼Œå»å¯¹åº”æ–‡ä»¶ä¿®æ”¹

![image-20231031214414293](assets/image-20231031214414293.png)

### åç«¯

1. ä½¿ç”¨åç«¯é¡¹ç›®æ¨¡æ¿

å¤åˆ¶æ¨¡æ¿ï¼Œä¿®æ”¹ç›®å½•åä¸ºé¡¹ç›®å

2. è¿æ¥æ•°æ®åº“

   ![image-20231031113006757](assets/image-20231031113006757.png)

3. ä¿®æ”¹æ•°æ®åº“å

![image-20231031113312177](assets/image-20231031113312177.png)

4. ä¿®æ”¹é¡¹ç›®å

![image-20231031113526512](assets/image-20231031113526512.png)

![image-20231031113636977](assets/image-20231031113636977.png)

5. å¼€å¯åˆ†å¸ƒå¼session

![image-20231031114027856](assets/image-20231031114027856.png)

![image-20231031114048256](assets/image-20231031114048256.png)

6. ä¿®æ”¹ç«¯å£

![image-20231031114227436](assets/image-20231031114227436.png)

7. å¯åŠ¨å¹¶è®¿é—®æ¥å£æ–‡æ¡£

![image-20231031114401762](assets/image-20231031114401762.png)

## åç«¯

### æ•°æ®åº“è¡¨è®¾è®¡

**ç”¨æˆ·è¡¨ï¼š**

```sql
create table if not exists user
(
    id           bigint auto_increment comment 'id' primary key,
    userAccount  varchar(256)                           not null comment 'è´¦å·',
    userPassword varchar(512)                           not null comment 'å¯†ç ',
    userName     varchar(256)                           null comment 'ç”¨æˆ·æ˜µç§°',
    userAvatar   varchar(1024)                          null comment 'ç”¨æˆ·å¤´åƒ',
    userProfile  varchar(512)                           null comment 'ç”¨æˆ·ç®€ä»‹',
    userRole     varchar(256) default 'user'            not null comment 'ç”¨æˆ·è§’è‰²ï¼šuser/admin/ban',
    gender       tinyint                                null comment 'æ€§åˆ«',
    createTime   datetime     default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    updateTime   datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    isDelete     tinyint      default 0                 not null comment 'æ˜¯å¦åˆ é™¤',
    index idx_userAccount (userAccount)
) comment 'ç”¨æˆ·' collate = utf8mb4_unicode_ci;
```

**å›¾è¡¨ä¿¡æ¯è¡¨ï¼š**

```sql
create table if not exists chart
(
    id          bigint auto_increment comment 'id' primary key,
    goal        text                                   null comment 'åˆ†æç›®æ ‡',
    rawData     text                                   null comment 'åŸå§‹æ•°æ®',
    chartType   varchar(128)                           null comment 'å›¾è¡¨ç±»å‹',
    chartName   varchar(128)                           null comment 'å›¾è¡¨åç§°',
    genChart    text                                   null comment 'AIç”Ÿæˆçš„å›¾è¡¨æ•°æ®',
    genSummary  text                                   null comment 'AIç”Ÿæˆçš„åˆ†ææ€»ç»“',
    userId      bigint                                 null comment 'åˆ›å»ºäººid',
    status      varchar(128) default 'wait'            not null comment 'wait,succeeded,failed,running',
    execMessage text                                   null comment 'æ‰§è¡Œä¿¡æ¯',
    createTime  datetime     default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    updateTime  datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    isDelete    tinyint      default 0                 not null comment 'æ˜¯å¦åˆ é™¤'
) comment 'å›¾è¡¨ä¿¡æ¯' collate = utf8mb4_unicode_ci;
```

### è‡ªåŠ¨ç”Ÿæˆå¢åˆ æ”¹æŸ¥ä»£ç 

![image-20231031141404931](assets/image-20231031141404931.png)

![image-20231031141439155](assets/image-20231031141439155.png)

![image-20231031141503920](assets/image-20231031141503920.png)

1. ç”Ÿæˆçš„UserServiceå’ŒUserServiceImplä¸ç”¨æ›¿æ¢åŸæ¥çš„

2. ä¿®æ”¹å­—æ®µçš„æ³¨è§£

   ![image-20231031142728852](assets/image-20231031142728852.png)

   ![image-20231031142744734](assets/image-20231031142744734.png)

   ![image-20231031142801435](assets/image-20231031142801435.png)

   ![image-20231031142813281](assets/image-20231031142813281.png)

3. åˆ æ‰UserServiceå’ŒUserServiceImplå’ŒUserControllerä¸­ç”¨ä¸åˆ°çš„æ–¹æ³•

   ![image-20231031143327862](assets/image-20231031143327862.png)

   ![image-20231031143356282](assets/image-20231031143356282.png)

   ![image-20231031143538773](assets/image-20231031143538773.png)

4. åˆ æ‰å¾®ä¿¡å…¬ä¼—å·å¼€å‘åŒ…

   ![image-20231031143643260](assets/image-20231031143643260.png)

5. åˆ æ‰WxMPController

   ![image-20231031143826847](assets/image-20231031143826847.png)

### å›¾è¡¨ç®¡ç†

1. å¤åˆ¶PostControllerä¿®æ”¹æˆChartController

   ![image-20231031145120748](assets/image-20231031145120748.png)

   ![image-20231031145230166](assets/image-20231031145230166.png)

   ![image-20231031145445986](assets/image-20231031145445986.png)  

2. åˆ›å»ºå…³äºChartçš„DTOç±»

   ![image-20231031153057014](assets/image-20231031153057014.png)

3. å‰ªè£ChartControllerå¹¶ä¸ºChartServiceæä¾›getQueryWrapperæ–¹æ³•

   ```java
   /**
    * @author è½æ¨±çš„æ‚”æ¨
    * @description é’ˆå¯¹è¡¨ã€chart(å›¾è¡¨ä¿¡æ¯è¡¨)ã€‘çš„æ•°æ®åº“æ“ä½œServiceå®ç°
    * @createDate 2023-10-31 14:16:29
    */
   @Service
   public class ChartServiceImpl extends ServiceImpl<ChartMapper, Chart>
           implements ChartService {
   
       /**
        * è·å–æŸ¥è¯¢åŒ…è£…ç±»
        *
        * @param chartQueryRequest
        * @return
        */
       @Override
       public QueryWrapper<Chart> getQueryWrapper(ChartQueryRequest chartQueryRequest) {
           QueryWrapper<Chart> queryWrapper = new QueryWrapper<>();
           if (chartQueryRequest == null) {
               return queryWrapper;
           }
           Long id = chartQueryRequest.getId();
           Long userId = chartQueryRequest.getUserId();
           String goal = chartQueryRequest.getGoal();
           String chartType = chartQueryRequest.getChartType();
           String chartName = chartQueryRequest.getChartName();
           String sortField = chartQueryRequest.getSortField();
           String sortOrder = chartQueryRequest.getSortOrder();
           // æ‹¼æ¥æŸ¥è¯¢æ¡ä»¶
           queryWrapper.eq(id != null && id > 0, "id", id);
           queryWrapper.eq(ObjectUtils.isNotEmpty(userId), "userId", userId);
           queryWrapper.like(StringUtils.isNotBlank(goal), "goal", goal);
           queryWrapper.like(StringUtils.isNotBlank(chartType), "chartType", chartType);
           queryWrapper.like(StringUtils.isNotBlank(chartName), "chartName", chartName);
           queryWrapper.eq("isDelete", false);
           queryWrapper.orderBy(SqlUtils.validSortField(sortField), sortOrder.equals(CommonConstant.SORT_ORDER_ASC),
                   sortField);
           return queryWrapper;
       }
   }
   ```


### æ™ºèƒ½å›¾è¡¨åˆ†æ

#### **AIè°ƒç”¨çš„å‡ ç§æ–¹å¼**

**1ã€ç›´æ¥è°ƒç”¨ OpenAI æˆ–è€…å…¶ä»– AI åŸå§‹å¤§æ¨¡å‹å®˜ç½‘çš„æ¥å£**

å®˜æ–¹æ–‡æ¡£ï¼šhttps://platform.openai.com/docs/api-reference

ä¼˜ç‚¹ï¼šä¸ç»å°è£…ï¼Œæœ€çµæ´»ï¼Œæœ€åŸå§‹

ç¼ºç‚¹ï¼šè¦é’±

ä½¿ç”¨æ–¹å¼ï¼š

1ï¼‰åœ¨è¯·æ±‚å¤´ä¸­æŒ‡å®šOPENAI_API_KEY

```
Authorization: Bearer OPENAI_API_KEY
```

2ï¼‰æ‰¾åˆ°è¦ä½¿ç”¨çš„æ¥å£ https://platform.openai.com/docs/api-reference/chat/create

3ï¼‰æŒ‰ç…§æ¥å£æ–‡æ¡£çš„ç¤ºä¾‹ï¼Œæ„é€  HTTP è¯·æ±‚

```
curl https://api.openai.com/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -d '{
    "model": "gpt-3.5-turbo",
    "messages": [
      {
        "role": "system",
        "content": "You are a helpful assistant."
      },
      {
        "role": "user",
        "content": "Hello!"
      }
    ]
  }'

```

```java
import cn.hutool.http.HttpRequest;
import cn.hutool.json.JSONUtil;

import java.util.*;

public class OpenAIAPI {
    public static void main(String[] args) {
        String url = "https://api.openai.com/v1/chat/completions";

        LinkedHashMap<String,Object> map =new LinkedHashMap<>();
        List<LinkedHashMap<String,Object>> messageList =new ArrayList<>();

        LinkedHashMap<String,Object> messageMap =new LinkedHashMap<>();
        messageMap.put("role","system");
        messageMap.put("content","You are a helpful assistant.");

        messageList.add(messageMap);

        map.put("model","gpt-3.5-turbo");
        map.put("message",messageList);

        String requestBody = JSONUtil.toJsonStr(map);
        HttpRequest.post(url)
                .header("Authorization","Bearer OPENAI_API_KEY")
                .header("Content-Type","application/json")
                .body(requestBody)
                .execute()
                .body();
    }
}
```

![image-20231102104638957](assets/image-20231102104638957.png)

**2ã€ä½¿ç”¨äº‘æœåŠ¡å•†æä¾›çš„ï¼Œå°è£…åçš„ AI æ¥å£**

æ¯”å¦‚ï¼šAzureäº‘

ä¼˜ç‚¹ï¼šæœ¬åœ°èƒ½ç”¨

ç¼ºç‚¹ï¼šè¦é’±

**3ã€åˆ©ç”¨é±¼èªæ˜ AI æä¾›çš„å¼€æ”¾ SDK** https://github.com/liyupi/yucongming-java-sdk

ä¼˜ç‚¹ï¼šç›®å‰ä¸è¦é’±ï¼Œæœ‰å¾ˆå¤šç°æˆçš„æ¨¡å‹

ç¼ºç‚¹ï¼šä¸å¤Ÿçµæ´»

1ï¼‰å¼•å…¥ä¾èµ–

```xml
<dependency>
    <groupId>com.yucongming</groupId>
    <artifactId>yucongming-java-sdk</artifactId>
    <version>0.0.3</version>
</dependency>
```

2ï¼‰ä¿®æ”¹é…ç½®

```yml
yuapi:
  client:
    access-key: c34re67to6v7yu2qf4nzawr8ultmy0a2
    secret-key: i6cnztxw6scfmrtykndjd5apitqcrejv
```

3ï¼‰è°ƒç”¨æ¥å£

```java
@Component
public class AIManager {
    @Resource
    private YuCongMingClient yuCongMingClient;

    /**
     *
     * @param modelId
     * @param message
     * @return
     */
    public String doChat(long modelId,String message){
        DevChatRequest devChatRequest = new DevChatRequest();
        devChatRequest.setModelId(modelId);
        devChatRequest.setMessage(message);
        BaseResponse<DevChatResponse> response = yuCongMingClient.doChat(devChatRequest);
        if (response==null){
            throw new BusinessException(ErrorCode.SYSTEM_ERROR,"AIå“åº”é”™è¯¯");
        }
        return response.getData().getContent();
    }
}
```

#### ä¸šåŠ¡æµç¨‹

1. æ ¡éªŒå‚æ•°
2. å‹ç¼©åŸå§‹æ•°æ®ï¼šAIæ¥å£æ™®ééƒ½æœ‰è¾“å…¥å­—æ•°é™åˆ¶ï¼Œå°½å¯èƒ½å‹ç¼©æ•°æ®ï¼Œèƒ½å¤Ÿå¤šä¼ ä¸€äº›æ•°æ®
3. æ„é€ ç”¨æˆ·è¯·æ±‚ï¼ˆåˆ†æç›®æ ‡ï¼Œå›¾è¡¨åç§°ï¼Œå›¾è¡¨ç±»å‹ï¼Œcsvæ•°æ®ï¼‰
4. è°ƒç”¨é±¼èªæ˜SDKï¼Œå¾—åˆ°å“åº”ï¼ˆå›¾è¡¨ä¿¡æ¯ï¼Œç»“è®ºæ–‡æœ¬ï¼‰
5. ä»AIå“åº”ç»“æœä¸­ï¼Œå–å‡ºéœ€è¦çš„æ•°æ®ï¼ˆå›¾è¡¨ä¿¡æ¯ï¼šEcharts V5 çš„ options é…ç½®å¯¹è±¡jsä»£ç ï¼›ç»“è®ºæ–‡æœ¬ï¼‰
6. ä¿å­˜åˆ°æ•°æ®åº“
7. è¿”å›å›¾è¡¨ä¿¡æ¯ï¼Œç»“è®ºæ–‡æœ¬ï¼Œå›¾è¡¨IDç»™å‰ç«¯

**æ¨¡å‹é¢„è®¾**

```
ä½ æ˜¯ä¸€ä¸ªæ•°æ®åˆ†æå¸ˆå’Œå‰ç«¯å¼€å‘ä¸“å®¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šæŒ‰ç…§ä»¥ä¸‹å›ºå®šæ ¼å¼ç»™ä½ æä¾›å†…å®¹ï¼š
åˆ†æéœ€æ±‚ï¼š
{æ•°æ®åˆ†æçš„éœ€æ±‚æˆ–è€…ç›®æ ‡}
åŸå§‹æ•°æ®ï¼š
{csvæ ¼å¼çš„åŸå§‹æ•°æ®ï¼Œç”¨,ä½œä¸ºåˆ†éš”ç¬¦}
è¯·æ ¹æ®è¿™ä¸¤éƒ¨åˆ†å†…å®¹ï¼ŒæŒ‰ç…§ä»¥ä¸‹æŒ‡å®šæ ¼å¼ç”Ÿæˆå†…å®¹ï¼ˆæ­¤å¤–ä¸è¦è¾“å‡ºä»»ä½•å¤šä½™çš„å¼€å¤´ã€ç»“å°¾ã€æ³¨é‡Šï¼‰
ã€ã€ã€ã€ã€
{å‰ç«¯ Echarts V5 çš„ option é…ç½®å¯¹è±¡jsonä»£ç ï¼Œåˆç†åœ°å°†æ•°æ®è¿›è¡Œå¯è§†åŒ–ï¼Œä¸è¦ç”Ÿæˆä»»ä½•å¤šä½™çš„å†…å®¹ï¼Œæ¯”å¦‚æ³¨é‡Š}
ã€ã€ã€ã€ã€
{æ˜ç¡®çš„æ•°æ®åˆ†æç»“è®ºã€è¶Šè¯¦ç»†è¶Šå¥½ï¼Œä¸è¦ç”Ÿæˆå¤šä½™çš„æ³¨é‡Š}
```

![image-20231102134925868](assets/image-20231102134925868.png)

```java
@Data
public class GenChartRequest implements Serializable {

    /**
     * åˆ†æç›®æ ‡
     */
    private String goal;

    /**
     * å›¾è¡¨ç±»å‹
     */
    private String chartType;

    /**
     * å›¾è¡¨åç§°
     */
    private String chartName;

    private static final long serialVersionUID = 1L;
}
```

```java
/**
 * BIçš„è¿”å›ç»“æœ
 */
@Data
public class BIResponse {
    private String genChart;

    private String genSummary;

    private Long chartId;
}
```

```java
@Slf4j
public class ExcelUtils {
    public static String excelToCsv(MultipartFile multipartFile) {
        /*File file = null;
        try {
            file = ResourceUtils.getFile("classpath:ç½‘ç«™æ•°æ®.xlsx");
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        }*/
        // 1. ä»æ–‡ä»¶è¯»å–å‡ºæ•°æ®
        List<Map<Integer, String>> list = null;
        try {
            list = EasyExcel.read(multipartFile.getInputStream())
                    .excelType(ExcelTypeEnum.XLSX)
                    .sheet()
                    .headRowNumber(0)
                    .doReadSync();
        } catch (IOException e) {
            log.error("è¡¨æ ¼å¤„ç†é”™è¯¯",e);
        }
        if (CollectionUtil.isEmpty(list)) {
            return "";
        }
        // 2. è½¬æ¢ä¸ºcsv
        StringBuilder stringBuilder = new StringBuilder();
        // 2.1 è¯»å–è¡¨å¤´
        LinkedHashMap<Integer, String> headerMap = (LinkedHashMap) list.get(0);
        List<String> headerList =headerMap.values().stream().filter(ObjectUtils::isNotEmpty).collect(Collectors.toList());
        stringBuilder.append(StringUtils.join(headerList, ",")).append("\n");
        // 2.1 è¯»å–æ•°æ®è¡Œ
        for (int i = 1; i < list.size(); i++) {
            LinkedHashMap<Integer, String> dataMap = (LinkedHashMap) list.get(i);
            List<String> dataList = dataMap.values().stream().filter(ObjectUtils::isNotEmpty).collect(Collectors.toList());
            stringBuilder.append(StringUtils.join(dataList, ",")).append("\n");
        }
        return stringBuilder.toString();
    }
}
```

```java
@Service
public class AIManager {
    @Resource
    private YuCongMingClient yuCongMingClient;

    /**
     *
     * @param modelId
     * @param message
     * @return
     */
    public String doChat(long modelId,String message){
        DevChatRequest devChatRequest = new DevChatRequest();
        devChatRequest.setModelId(modelId);
        devChatRequest.setMessage(message);
        BaseResponse<DevChatResponse> response = yuCongMingClient.doChat(devChatRequest);
        if (response==null){
            throw new BusinessException(ErrorCode.SYSTEM_ERROR,"AIå“åº”é”™è¯¯");
        }
        return response.getData().getContent();
    }
}
```

```java
/**
 * æ™ºèƒ½åˆ†æ
 *
 * @param multipartFile
 * @param genChartRequest
 * @param request
 * @return
 */
@PostMapping("/gen")
public BaseResponse<BIResponse> genChartByAI(@RequestPart("file") MultipartFile multipartFile,
                                             GenChartRequest genChartRequest, HttpServletRequest request) {
    String goal = genChartRequest.getGoal();
    String chartType = genChartRequest.getChartType();
    String chartName = genChartRequest.getChartName();
    // æ‹¼æ¥åˆ†æç›®æ ‡
    if (StringUtils.isNotBlank(chartType)) {
        goal = goal + "ï¼Œè¯·ä½¿ç”¨" + chartType;
    }
    // æ ¡éªŒå‚æ•°
    ThrowUtils.throwIf(StringUtils.isBlank(goal), ErrorCode.PARAMS_ERROR, "åˆ†æç›®æ ‡ä¸ºç©º");
    ThrowUtils.throwIf(StringUtils.isNotBlank(chartName) && chartName.length() > 128, ErrorCode.PARAMS_ERROR, "å›¾è¡¨åç§°è¿‡é•¿");
    // è·å–ç™»å½•ç”¨æˆ·
    User loginUser = userService.getLoginUser(request);
    // å‹ç¼©åŸå§‹æ•°æ®
    String data = ExcelUtils.excelToCsv(multipartFile);
    // æ„é€ ç”¨æˆ·è¯·æ±‚ï¼ˆåˆ†æç›®æ ‡ï¼Œå›¾è¡¨åç§°ï¼Œå›¾è¡¨ç±»å‹ï¼Œcsvæ•°æ®ï¼‰
    StringBuilder userInput = new StringBuilder();
    userInput.append("åˆ†æéœ€æ±‚ï¼š").append("\n");
    userInput.append(goal).append("\n");
    userInput.append("åŸå§‹æ•°æ®ï¼š").append("\n");
    userInput.append(data).append("\n");
    // è°ƒç”¨é±¼èªæ˜SDKï¼Œå¾—åˆ°å“åº”
    long biModelId = 1719916921023344642L;
    String answer = aiManager.doChat(biModelId, userInput.toString());
    // ä»AIå“åº”ç»“æœä¸­ï¼Œå–å‡ºéœ€è¦çš„æ•°æ®
    String[] splits = answer.split("ã€ã€ã€ã€ã€");
    if (splits.length < 3) {
        throw new BusinessException(ErrorCode.SYSTEM_ERROR, "AIç”Ÿæˆé”™è¯¯");
    }
    String genChart = splits[1].trim();
    String genSummary = splits[2].trim();
    // æ’å…¥æ•°æ®åº“
    Chart chart = new Chart();
    chart.setGoal(goal);
    chart.setRawData(data);
    chart.setChartType(chartType);
    chart.setChartName(chartName);
    chart.setGenChart(genChart);
    chart.setGenSummary(genSummary);
    chart.setUserId(loginUser.getId());
    boolean save = chartService.save(chart);
    ThrowUtils.throwIf(!save, ErrorCode.SYSTEM_ERROR, "å›¾è¡¨ä¿å­˜å¤±è´¥");
    // è¿”å›ç»™å‰ç«¯
    BIResponse biResponse = new BIResponse();
    biResponse.setGenChart(genChart);
    biResponse.setGenSummary(genSummary);
    biResponse.setChartId(chart.getId());
    return ResultUtils.success(biResponse);
}
```

![image-20231102135109277](assets/image-20231102135109277.png)

### ç³»ç»Ÿä¼˜åŒ–

#### å®‰å…¨æ€§

**é—®é¢˜ï¼š**å¦‚æœç”¨æˆ·ä¸Šä¼ ä¸€ä¸ªè¶…å¤§çš„æ–‡ä»¶æ€ä¹ˆåŠï¼Ÿæ¯”å¦‚1000G

**è§£å†³ï¼š**åªè¦æ¶‰åŠåˆ°ç”¨æˆ·è‡ªä¸»ä¸Šä¼ çš„æ“ä½œï¼Œä¸€å®šè¦æ ¡éªŒæ–‡ä»¶

- æ–‡ä»¶çš„å¤§å°
- æ–‡ä»¶çš„åç¼€
- æ–‡ä»¶çš„å†…å®¹ï¼ˆæˆæœ¬é«˜ä¸€äº›ï¼‰
- æ–‡ä»¶çš„åˆæ³•æ€§ï¼ˆä¸èƒ½æœ‰æ•æ„Ÿçš„å†…å®¹ï¼Œå»ºè®®ç”¨ç¬¬ä¸‰æ–¹çš„å®¡æ ¸åŠŸèƒ½ï¼Œä¸è¦è‡ªå·±å†™ï¼‰

```java
// æ ¡éªŒæ–‡ä»¶
long size = multipartFile.getSize();
String originalFilename = multipartFile.getOriginalFilename();
// æ ¡éªŒæ–‡ä»¶å¤§å°
final long ONE_MB = 1024 * 1024L;
ThrowUtils.throwIf(size > ONE_MB, ErrorCode.PARAMS_ERROR, "æ–‡ä»¶å¤§å°è¶…è¿‡ 1M");
// æ ¡éªŒæ–‡ä»¶åç¼€
String suffix = FileUtil.getSuffix(originalFilename);
final List<String> validFileSuffix = Arrays.asList("xlsx");
ThrowUtils.throwIf(!validFileSuffix.contains(suffix), ErrorCode.PARAMS_ERROR, "æ–‡ä»¶åç¼€ä¸ç¬¦åˆè¦æ±‚");
```

**æ‰©å±•ç‚¹ï¼š**

æ¥å…¥è…¾è®¯äº‘çš„å›¾ç‰‡ä¸‡è±¡æ•°æ®å®¡æ ¸ï¼ˆCOSå¯¹è±¡å­˜å‚¨çš„å®¡æ ¸åŠŸèƒ½ï¼‰



#### æ•°æ®å­˜å‚¨

**ç°çŠ¶ï¼š**æˆ‘ä»¬æŠŠæ¯ä¸ªå›¾è¡¨çš„åŸå§‹æ•°æ®å­˜æ”¾åœ¨äº†åŒä¸€ä¸ªæ•°æ®è¡¨ï¼ˆchartè¡¨ï¼‰çš„å­—æ®µé‡Œ

**é—®é¢˜ï¼š**

1. å¦‚æœç”¨æˆ·æ—¥ç›Šå¢å¤šï¼Œé‚£ä¹ˆå›¾è¡¨æ•°ä¹Ÿä¼šå¢å¤šï¼Œå†å¦‚æœç”¨æˆ·ä¸Šä¼ çš„å›¾è¡¨åŸå§‹æ•°æ®é‡å¾ˆå¤§ï¼Œå°±ä¼šé€ æˆå•è¡¨ä½“ç§¯å¾ˆå¤§ï¼ŒæŸ¥è¯¢ä¹Ÿä¼šå˜æ…¢
2. å¯¹äº BI å¹³å°ï¼Œç”¨æˆ·æ˜¯æœ‰æŸ¥çœ‹åŸå§‹æ•°æ®ï¼Œå¯¹åŸå§‹æ•°æ®è¿›è¡Œç®€å•æŸ¥è¯¢çš„éœ€æ±‚çš„ã€‚ç°åœ¨å¦‚æœæŠŠæ‰€æœ‰æ•°æ®å­˜æ”¾åœ¨ä¸€ä¸ªå­—æ®µä¸­ï¼ŒæŸ¥è¯¢æ—¶ï¼Œåªèƒ½å–è¿™ä¸ªå­—æ®µçš„æ‰€æœ‰æ•°æ®

**è§£å†³ï¼š**

1. æŠŠæ¯ä¸ªå›¾è¡¨å¯¹åº”çš„åŸå§‹æ•°æ®å•ç‹¬ä¿å­˜ä¸ºä¸€ä¸ªæ–°çš„æ•°æ®è¡¨ï¼Œè€Œä¸æ˜¯éƒ½å­˜åœ¨ä¸€ä¸ªå­—æ®µé‡Œ

![image-20231104095152123](assets/image-20231104095152123.png)

**å¥½å¤„ï¼š**

1. å­˜å‚¨æ—¶ï¼Œåˆ†å¼€å­˜å‚¨ï¼Œäº’ä¸å½±å“ï¼ˆä¹Ÿèƒ½å¢åŠ å®‰å…¨æ€§ï¼Œé˜²æ­¢æ¶æ„ç”¨æˆ·ä¸Šä¼ å¤§æ–‡ä»¶ï¼Œå½±å“å…¶ä»–ç”¨æˆ·ä½“éªŒï¼‰
2. æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥ä½¿ç”¨sqlè¯­å¥çµæ´»å–å‡ºéœ€è¦çš„å­—æ®µï¼ŒæŸ¥è¯¢æ€§èƒ½æ›´å¿«

**å®ç°ï¼š**

åˆ†å¼€å­˜å‚¨ï¼š

1. å­˜å‚¨å›¾è¡¨ä¿¡æ¯æ—¶ï¼Œä¸æŠŠå›¾è¡¨æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªå­—æ®µï¼Œè€Œæ˜¯æ–°å»ºä¸€ä¸ª chart_{å›¾è¡¨id} çš„æ•°æ®è¡¨

é€šè¿‡å›¾è¡¨idï¼Œæ•°æ®åˆ—åï¼Œæ•°æ®ç±»å‹ç­‰å­—æ®µï¼Œç”Ÿæˆä»¥ä¸‹sqlè¯­å¥ï¼Œå¹¶ä¸”æ‰§è¡Œå³å¯

```sql
create table chart_1720380873253691394
(
    æ—¥æœŸ  varchar(128) null,
    ç”¨æˆ·æ•° int          null
);
```

åˆ†å¼€æŸ¥è¯¢ï¼š

1. ä»¥å‰ç›´æ¥æŸ¥è¯¢å›¾è¡¨ï¼Œå–chartDataå­—æ®µï¼›ç°åœ¨æ”¹ä¸ºè¯»å–chart_{å›¾è¡¨id}çš„æ•°æ®è¡¨

```sql
select * from chart_1720380873253691394
```

**å…·ä½“å®ç°ï¼šMybatisçš„åŠ¨æ€SQL**

1ã€æƒ³æ¸…æ¥šå“ªäº›æ˜¯éœ€è¦åŠ¨æ€æ›¿æ¢çš„ï¼Œæ¯”å¦‚æŸ¥è¯¢çš„æ•°æ®è¡¨åchart_1720380873253691394 

2ã€åœ¨mapper.xmlä¸­å®šä¹‰sqlè¯­å¥

è¯¥æ–¹å¼æœ€çµæ´»ï¼Œä½†éœ€è¦å°å¿ƒsqlæ³¨å…¥

```sql
<select id="queryChartData" parameterType="string" resultType="map">
    ${querySql}
</select>
```

3ã€åœ¨mapperç±»ä¸­æ·»åŠ æ–¹æ³•

```java
public interface ChartMapper extends BaseMapper<Chart> {
    List<Map<String, Object>> queryChartData(@Param("querySql") String querySql);
}
```

4ã€æµ‹è¯•è°ƒç”¨

```java
@SpringBootTest
class ChartMapperTest {
    @Resource
    private ChartMapper chartMapper;

    @Test
    void queryChartData() {
        long chartId = 1720380873253691394L;
        String querySql = String.format("select * from chart_%s", chartId);
        List<Map<String, Object>> resultData = chartMapper.queryChartData(querySql);
        System.out.println(resultData);

    }
}
```

5ã€ç»“æœ

![image-20231104103300734](assets/image-20231104103300734.png)

**åˆ†åº“åˆ†è¡¨ï¼š**

1. æ°´å¹³åˆ†è¡¨ ï¼ˆæ ¹æ®ä¸€å®šçš„è§„åˆ™ï¼ŒæŠŠä¸€å¼ è¡¨çš„æ•°æ®åˆ’åˆ†åˆ°ä¸åŒçš„ç‰©ç†å­˜å‚¨ä½ç½®ä¸Šï¼‰
2. å‚ç›´åˆ†åº“ ï¼ˆæ ¹æ®ä¸šåŠ¡ï¼Œæ¯”å¦‚è®¢å•æ•°æ®åº“ï¼Œå•†å“æ•°æ®åº“ï¼‰

#### é™æµ

**é—®é¢˜ï¼š**ä½¿ç”¨ç³»ç»Ÿæ˜¯éœ€è¦æ¶ˆè€—æˆæœ¬çš„ï¼Œç”¨æˆ·æœ‰å¯èƒ½ç–¯ç‹‚åˆ·é‡ï¼Œè®©ä½ ç ´äº§

**è§£å†³ï¼š**

1ã€é™åˆ¶ç”¨æˆ·è°ƒç”¨æ€»æ¬¡æ•°ï¼Œæ§åˆ¶æˆæœ¬

2ã€ç”¨æˆ·åœ¨çŸ­æ—¶é—´å†…ç–¯ç‹‚ä½¿ç”¨ï¼Œå¯¼è‡´æœåŠ¡å™¨èµ„æºè¢«å æ»¡ï¼Œå…¶ä»–ç”¨æˆ·æ— æ³•ä½¿ç”¨ => é™æµï¼Œé™åˆ¶å•ä½æ—¶é—´å†…è¯·æ±‚æ•°

**æ€è€ƒé™æµé˜ˆå€¼ï¼š**

1. å‚è€ƒæ­£å¸¸ç”¨æˆ·çš„ä½¿ç”¨é¢‘ç‡ï¼Œæ¯”å¦‚å•ä¸ªç”¨æˆ·æ¯ç§’åªèƒ½è°ƒç”¨ä¸€æ¬¡

**é™æµçš„å‡ ç§ç®—æ³•ï¼š**[é¢è¯•å¿…å¤‡ï¼š4ç§ç»å…¸é™æµç®—æ³•è®²è§£ - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/6967742960540581918)

**1ã€å›ºå®šçª—å£é™æµ**

å•ä½æ—¶é—´å†…å…è®¸éƒ¨åˆ†æ“ä½œï¼šæ¯”å¦‚1å°æ—¶åªå…è®¸10ä¸ªç”¨æˆ·æ“ä½œ

ä¼˜ç‚¹ï¼šç®€å•

ç¼ºç‚¹ï¼šå¯èƒ½å‡ºç°æµé‡çªåˆºï¼Œæ¯”å¦‚å‰59åˆ†é’Ÿæ²¡æœ‰ä¸€ä¸ªæ“ä½œï¼Œç¬¬59åˆ†é’Ÿæ¥äº†10ä¸ªæ“ä½œï¼Œç¬¬1å°æ—¶01åˆ†é’Ÿæ¥äº†10ä¸ªæ“ä½œã€‚ç›¸å½“äº2åˆ†é’Ÿæ‰§è¡Œäº†20ä¸ªæ“ä½œï¼ŒæœåŠ¡å™¨å¯èƒ½æ‰¿å—ä¸ä½å°±å´©äº†

**2ã€æ»‘åŠ¨çª—å£é™æµ**

å•ä½æ—¶é—´å†…å…è®¸éƒ¨åˆ†æ“ä½œï¼Œä½†æ˜¯è¿™ä¸ªå•ä½æ—¶é—´æ˜¯æ»‘åŠ¨çš„ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªæ»‘åŠ¨å•ä½ï¼Œå³å¤šå°‘å•ä½æ—¶é—´æ»‘åŠ¨ä¸€æ¬¡

æ¯”å¦‚æ»‘åŠ¨å•ä½ï¼š1min

0h      1h         2h

è¿‡äº†1min

1min  - 1h1min

ä¼˜ç‚¹ï¼šèƒ½å¤Ÿè§£å†³ä¸Šè¿°æµé‡çªåˆºé—®é¢˜ï¼Œå› ä¸ºç¬¬59åˆ†é’Ÿæ—¶ï¼Œé™æµçª—å£æ˜¯59åˆ† -  1å°æ—¶59åˆ†ï¼Œè¿™ä¸ªçª—å£å†…åªèƒ½æ¥å—10æ¬¡è¯·æ±‚ï¼Œåªè¦è¿˜åœ¨è¿™ä¸ªçª—å£å†…ï¼Œæ›´å¤šçš„æ“ä½œå°±ä¼šè¢«æ‹’ç»

ç¼ºç‚¹ï¼šå®ç°ç›¸å¯¹å¤æ‚ï¼Œé™æµæ•ˆæœå’Œæ»‘åŠ¨å•ä½æœ‰å…³ï¼Œæ»‘åŠ¨å•ä½è¶Šå°ï¼Œé™æµæ•ˆæœè¶Šå¥½ï¼Œä½†å¾€å¾€å¾ˆéš¾é€‰å–åˆ°ä¸€ä¸ªåˆé€‚çš„æ»‘åŠ¨å•ä½

**3ã€æ¼æ¡¶é™æµ**ï¼ˆæ¨èï¼‰

ä»¥å›ºå®šçš„é€Ÿç‡å¤„ç†è¯·æ±‚ï¼Œå½“è¯·æ±‚é€šæ»¡äº†ï¼Œæ‹’ç»è¯·æ±‚

å‡è®¾æ¡¶çš„å®¹é‡æ˜¯10ï¼Œæ¯ç§’èƒ½å¤„ç†10ä¸ªè¯·æ±‚ï¼Œæ¯0.1ç§’å›ºå®šå¤„ç†ä¸€æ¬¡è¯·æ±‚ï¼Œå¦‚æœ1ç§’å†…æ¥äº†10ä¸ªè¯·æ±‚ï¼Œå¯ä»¥å¤„ç†å®Œã€‚ä½†1ç§’å†…æ¥äº†11ä¸ªè¯·æ±‚ï¼Œæœ€åå“ªä¸ªè¯·æ±‚ä¼šæº¢å‡ºæ¡¶ï¼Œè¢«æ‹’ç»

ä¼˜ç‚¹ï¼šèƒ½å¤Ÿä¸€å®šç¨‹åº¦ä¸Šåº”å¯¹æµé‡çªåˆºï¼Œå›ºå®šé€Ÿç‡å¤„ç†è¯·æ±‚ï¼Œä¿è¯æœåŠ¡å™¨çš„å®‰å…¨

ç¼ºç‚¹ï¼šæ²¡æœ‰åŠæ³•è¿…é€Ÿå¤„ç†	ä¸€æ‰¹è¯·æ±‚ï¼Œåªèƒ½ä¸€ä¸ªä¸€ä¸ªæŒ‰é¡ºåºæ¥å¤„ç†

**4ã€ä»¤ç‰Œæ¡¶é™æµ**ï¼ˆæ¨èï¼‰

ç®¡ç†å‘˜ç”Ÿæˆä¸€æ‰¹ä»¤ç‰Œï¼Œæ¯ç§’ç”Ÿæˆ10ä¸ªä»¤ç‰Œï¼›ç”¨æˆ·æ“ä½œå‰ï¼Œå…ˆå»æ‹¿åˆ°ä¸€ä¸ªä»¤ç‰Œï¼Œæœ‰ä»¤ç‰Œçš„äººå°±æœ‰èµ„æ ¼æ‰§è¡Œæ“ä½œï¼Œèƒ½åŒæ—¶æ‰§è¡Œæ“ä½œã€‚æ‹¿ä¸åˆ°ä»¤ç‰Œå°±ç­‰ç€

ä¼˜ç‚¹ï¼šèƒ½å¤Ÿå¹¶å‘å¤„ç†åŒæ—¶çš„è¯·æ±‚

éœ€è¦è€ƒè™‘çš„é—®é¢˜ï¼šè¿˜æ˜¯å­˜åœ¨æ—¶é—´å•ä½é€‰å–é—®é¢˜

**é™æµç²’åº¦ï¼š**

1. é’ˆå¯¹æŸä¸ªæ–¹æ³•é™æµï¼Œå³å•ä½æ—¶é—´å†…æœ€å¤šå…è®¸åŒæ—¶ xx ä¸ªæ“ä½œä½¿ç”¨è¯¥æ–¹æ³•
2. é’ˆå¯¹æŸä¸ªç”¨æˆ·é™æµï¼Œå³å•ä½æ—¶é—´å†…æœ€å¤šæ‰§è¡Œ xx ä¸ªæ“ä½œ
3. é’ˆå¯¹æŸä¸ªç”¨æˆ·æŸä¸ªæ–¹æ³•é™æµï¼Œ

**é™æµå®ç°ï¼š**

**1ã€æœ¬åœ°é™æµï¼ˆå•æœºé™æµï¼‰**

ä¸€èˆ¬é€‚ç”¨äºåªæœ‰ä¸€ä¸ªæœåŠ¡å™¨çš„é¡¹ç›®ï¼ˆå•ä½“é¡¹ç›®ï¼‰ï¼Œå¦‚æœæœ‰å¤šå°æœåŠ¡å™¨ï¼Œä¼šå­˜åœ¨æœåŠ¡å™¨ä¹‹é—´ç»Ÿè®¡æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œæ¯”å¦‚è°ƒç”¨æ¬¡æ•°ä¸ä¸€è‡´

ç¬¬ä¸‰æ–¹åº“ï¼šGuava RateLimiter



**2ã€åˆ†å¸ƒå¼é™æµï¼ˆå¤šæœºé™æµï¼Œå¾®æœåŠ¡é¡¹ç›®ï¼‰**

1ã€æŠŠç”¨æˆ·ä½¿ç”¨é¢‘ç‡ç­‰æ•°æ®æ”¾åˆ°ä¸€ä¸ªé›†ä¸­å­˜å‚¨å»ç»Ÿè®¡ï¼Œæ¯”å¦‚ä½¿ç”¨Redisï¼Œè¿™æ ·æ— è®ºç”¨æˆ·è¯·æ±‚è½åˆ°å“ªå°æœåŠ¡å™¨ï¼Œéƒ½å·²é›†ä¸­å­˜å‚¨ä¸­çš„æ•°æ®ä¸ºå‡†(Redisson)

2ã€åœ¨ç½‘å…³é›†ä¸­è¿›è¡Œé™æµå’Œç»Ÿè®¡ï¼ˆSentinelï¼ŒSpring Cloud Gateway)

**Redissoné™æµå®ç°**     https://github.com/redisson/redisson#quick-start

Redissonå†…ç½®äº†ä¸€ä¸ªé™æµå·¥å…·ç±»ï¼Œå¯ä»¥å¸®åŠ©ä½ åˆ©ç”¨Redisæ¥å­˜å‚¨ï¼Œç»Ÿè®¡

1. å¼•å…¥ä¾èµ–

```xml
<dependency>
   <groupId>org.redisson</groupId>
   <artifactId>redisson</artifactId>
   <version>3.24.3</version>
</dependency>  
```

2. åˆ›å»ºå®¢æˆ·ç«¯

```java
@Configuration
@ConfigurationProperties(prefix = "spring.redis")
@Data
public class RedissonConfig {
    private Integer dataBase;
    private String host;
    private Integer port;
    private String password;

    @Bean
    public RedissonClient redissonClient() {
        Config config = new Config();
        config.useSingleServer()
                .setDatabase(dataBase)
                .setAddress("redis://"+host+":"+port)
                .setPassword(password);
        RedissonClient redisson = Redisson.create(config);
        return redisson;
    }
}
```

3. RedisLimiterManager

   ä»€ä¹ˆæ˜¯Manager?ä¸“é—¨æä¾›RedisLimiter é™æµåŸºç¡€æœåŠ¡çš„ï¼ˆæä¾›äº†é€šç”¨çš„èƒ½åŠ›ï¼‰

```java
@Service
public class RedisLimiterManager {
    @Resource
    private RedissonClient redissonClient;

    /**
     * é™æµæ“ä½œ
     * @param key åŒºåˆ†ä¸åŒçš„é™æµå™¨ï¼Œæ¯”å¦‚ä¸åŒçš„ç”¨æˆ·Idï¼Œåº”è¯¥åˆ†åˆ«ç»Ÿè®¡
     */
    public void doRateLimit(String key){
        RRateLimiter rateLimiter = redissonClient.getRateLimiter(key);
        rateLimiter.trySetRate(RateType.OVERALL,2, 1,RateIntervalUnit.SECONDS);
        //æ¯å½“ä¸€ä¸ªæ“ä½œæ¥äº†åï¼Œè¯·æ±‚ä¸€ä¸ªä»¤ç‰Œ
        boolean canOp = rateLimiter.tryAcquire(1);
        if(!canOp) {
            throw new BusinessException(ErrorCode.TOO_MANY_REQUEST);
        }
    }
}
```

çœ‹ä¸åˆ°æ–¹æ³•å‚æ•°æ€ä¹ˆåŠï¼Ÿ

![image-20231104114523283](assets/image-20231104114523283.png)

1ã€çœ‹æ–‡æ¡£

2ã€ä¸‹è½½æºç ï¼šç‚¹è¿›ä»»æ„ä¸€ä¸ªåŒ…çš„ä»£ç ï¼Œç‚¹å‡»download sourceä¸‹è½½

![image-20231104114723886](assets/image-20231104114723886.png)

4. æµ‹è¯•è°ƒç”¨

```java
@SpringBootTest
class RedisLimiterManagerTest {
    @Resource
    private RedisLimiterManager redisLimiterManager;

    @Test
    void doRateLimit() {
        String userId = "1";
        //ä¸€ç§’è¯·æ±‚5æ¬¡	
        for (int i = 0; i < 5; i++) {
            redisLimiterManager.doRateLimit(userId);
            System.out.println("æˆåŠŸ");
        }
    }
}
```

![image-20231104115544690](assets/image-20231104115544690.png)

```java
@SpringBootTest
class RedisLimiterManagerTest {
    @Resource
    private RedisLimiterManager redisLimiterManager;

    @Test
    void doRateLimit() throws InterruptedException {
        String userId = "1";
        for (int i = 0; i < 2; i++) {
            redisLimiterManager.doRateLimit(userId);
            System.out.println("æˆåŠŸ");
        }
        Thread.sleep(1000);
        for (int i = 0; i < 5; i++) {
            redisLimiterManager.doRateLimit(userId);
            System.out.println("æˆåŠŸ");
        }
    }
}
```

![image-20231104115915513](assets/image-20231104115915513.png)

5. åº”ç”¨

```java
// é™æµ,æ¯ä¸ªç”¨æˆ·ä¸€ä¸ªé™æµå™¨
redisLimiterManager.doRateLimit("genChartByAI_"+loginUser.getId().toString());
```

#### å¼‚æ­¥åŒ–

**åº”ç”¨åœºæ™¯ï¼š**è°ƒç”¨çš„æœåŠ¡å¤„ç†èƒ½åŠ›æœ‰é™ï¼Œæˆ–è€…å¤„ç†æ—¶é—´æ¯”è¾ƒé•¿ï¼Œå°±åº”è¯¥è€ƒè™‘å¼‚æ­¥åŒ–ã€‚

**é—®é¢˜åˆ†æï¼š**

1. ç”¨æˆ·ç­‰å¾…AIç”Ÿæˆçš„æ—¶é—´æœ‰ç‚¹é•¿
2. æœåŠ¡å™¨å¯èƒ½ä¼šæœ‰å¾ˆå¤šè¯·æ±‚éœ€è¦å¤„ç†ï¼Œå¯¼è‡´ç³»ç»Ÿèµ„æºç´§å¼ ï¼Œä¸¥é‡æ—¶å¯¼è‡´æœåŠ¡å™¨å®•æœºæˆ–è€…æ— æ³•å¤„ç†æ–°çš„è¯·æ±‚
3. ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ˆAIèƒ½åŠ›ï¼‰çš„å¤„ç†èƒ½åŠ›æ˜¯æœ‰é™çš„ï¼Œæ¯”å¦‚æ¯3ç§’å¤„ç†1ä¸ªè¯·æ±‚ï¼Œè¿‡å¤šçš„è¯·æ±‚ä¼šå¯¼è‡´AIå¤„ç†ä¸è¿‡æ¥ï¼Œä¸¥é‡æ—¶ AI å¯èƒ½ä¼šæ‹’ç»ä¸ºåå°ç³»ç»Ÿæä¾›æœåŠ¡

**å¼‚æ­¥ï¼š**ä¸ç”¨ç­‰ä¸€ä»¶äº‹åšå®Œï¼Œå°±å¯ä»¥åšå¦ä¸€ä»¶äº‹ã€‚ç­‰ç¬¬ä¸€ä»¶äº‹åšå®Œï¼Œå¯ä»¥æ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ï¼Œå‘Šè¯‰ä½ è¿™ä»¶äº‹åšå®Œäº†ï¼Œä½ å¯ä»¥å†è¿›è¡Œåç»­å¤„ç†ã€‚

**ä¸šåŠ¡æµç¨‹åˆ†æï¼š**

1ã€æ ‡å‡†å¼‚æ­¥åŒ–çš„ä¸šåŠ¡æµç¨‹

1. å½“ç”¨æˆ·è¦è¿›è¡Œè€—æ—¶å¾ˆé•¿çš„æ“ä½œæ—¶ï¼Œç‚¹å‡»æäº¤åï¼Œä¸éœ€è¦åœ¨ç•Œé¢å¹²ç­‰ï¼Œè€Œæ˜¯åº”è¯¥æŠŠè¿™ä¸ªä»»åŠ¡ä¿å­˜åˆ°æ•°æ®åº“ï¼Œç„¶åæ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­

2. æ·»åŠ ä»»åŠ¡åˆ°ä»»åŠ¡é˜Ÿåˆ—æ—¶ï¼Œä¼šæœ‰ä»¥ä¸‹æƒ…å†µ

   a.æœ‰ç©ºé—²çº¿ç¨‹ï¼Œç«‹åˆ»è¿›è¡Œè¯¥ä»»åŠ¡

   b.æ²¡æœ‰ç©ºé—²çº¿ç¨‹ä¸”ä»»åŠ¡é˜Ÿåˆ—æ²¡æœ‰æ»¡ï¼ŒåŠ å…¥ä»»åŠ¡é˜Ÿåˆ—

   c.æ²¡æœ‰ç©ºé—²çº¿ç¨‹ä¸”ä»»åŠ¡é˜Ÿåˆ—å·²ç»æ»¡

   â€‹	i . æ‹’ç»ä»»åŠ¡

   â€‹	ii . åœ¨æœ‰ç©ºé—²çº¿ç¨‹æˆ–è€…ç©ºé—²é˜Ÿåˆ—ä½ç½®æ—¶ï¼Œä»æ•°æ®åº“ä¸­æŠŠä»»åŠ¡æå‡ºï¼Œå†å»æ‰§è¡Œ

3. ç¨‹åºï¼ˆçº¿ç¨‹ï¼‰ä»ä»»åŠ¡é˜Ÿåˆ—å–å‡ºä»»åŠ¡ä¾æ¬¡æ‰§è¡Œï¼Œæ¯å®Œæˆä¸€ä»¶äº‹æƒ…è¦ä¿®æ”¹ä¸€ä¸‹ä»»åŠ¡çš„çŠ¶æ€ã€‚

4. ç”¨æˆ·å¯ä»¥æŸ¥è¯¢ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ï¼Œæˆ–è€…åœ¨ä»»åŠ¡æ‰§è¡ŒæˆåŠŸæˆ–å¤±è´¥æ—¶èƒ½å¤Ÿå¾—åˆ°é€šçŸ¥ï¼ˆå‘é‚®ä»¶ï¼Œç³»ç»Ÿæ¶ˆæ¯æç¤ºï¼ŒçŸ­ä¿¡ï¼‰ï¼Œä»è€Œä¼˜åŒ–ä½“éªŒ

5. å¦‚æœè¦æ‰§è¡Œçš„ä»»åŠ¡éå¸¸å¤æ‚ï¼ŒåŒ…å«å¾ˆå¤šç¯èŠ‚ï¼Œåœ¨æ¯ä¸€ä¸ªç¯èŠ‚å®Œæˆæ—¶ï¼Œè¦åœ¨ç¨‹åºï¼ˆæ•°æ®åº“ï¼‰è®°å½•ä¸€ä¸‹è¯¥ç¯èŠ‚çš„æ‰§è¡ŒçŠ¶æ€ã€‚ä»è€Œç»™ç”¨æˆ·å±•ç¤ºä»»åŠ¡è¿›åº¦

2ã€æœ¬é¡¹ç›®å¼‚æ­¥åŒ–çš„ä¸šåŠ¡æµç¨‹

1. ç”¨æˆ·ç‚¹å‡»æ™ºèƒ½åˆ†æé¡µçš„æäº¤æŒ‰é’®ï¼Œå…ˆæŠŠå›¾è¡¨ç«‹åˆ»ä¿å­˜åˆ°æ•°æ®åº“ä¸­
2. ç”¨æˆ·å¯ä»¥åœ¨ä¸ªäººå›¾è¡¨é¡µé¢æŸ¥çœ‹æ‰€æœ‰å›¾è¡¨ï¼ˆå·²ç”Ÿæˆï¼Œç”Ÿæˆä¸­ï¼Œç”Ÿæˆå¤±è´¥ï¼‰çš„ä¿¡æ¯å’ŒçŠ¶æ€
3. ç”¨æˆ·å¯ä»¥ä¿®æ”¹ç”Ÿæˆå¤±è´¥çš„å›¾è¡¨ä¿¡æ¯ï¼Œç„¶åç‚¹å‡»é‡æ–°ç”Ÿæˆ

**é—®é¢˜ï¼š**

1. ä»»åŠ¡é˜Ÿåˆ—çš„æœ€å¤§å®¹é‡åº”è¯¥è®¾ç½®ä¸ºå¤šå°‘ï¼Ÿ
2. ç¨‹åºæ€ä¹ˆä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡å»æ‰§è¡Œï¼Ÿ
3. ä»»åŠ¡é˜Ÿåˆ—çš„æµç¨‹æ€ä¹ˆå®ç°
4. æ€ä¹ˆä¿è¯ç¨‹åºæœ€å¤šåŒæ—¶æ‰§è¡Œxä¸ªä»»åŠ¡

##### **çº¿ç¨‹æ± **

`ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹æ± ï¼Ÿ`

1. çº¿ç¨‹çš„ç®¡ç†æ¯”è¾ƒå¤æ‚ï¼ˆæ¯”å¦‚ä»€ä¹ˆæ—¶å€™æ–°å¢çº¿ç¨‹ï¼Œä»€ä¹ˆæ—¶å€™å‡å°‘ç©ºé—²çº¿ç¨‹ï¼‰
2. ä»»åŠ¡å­˜å–æ¯”è¾ƒå¤æ‚ï¼ˆä»€ä¹ˆæ—¶ä¾¯æ¯”è¾ƒå¤æ‚ï¼Œä»€ä¹ˆæ—¶å€™æ‹’ç»ä»»åŠ¡ï¼Œæ€ä¹ˆä¿è¯å„ä¸ªçº¿ç¨‹ä¸æŠ¢åˆ°ç”¨ä¸€ä¸ªä»»åŠ¡ï¼‰

`çº¿ç¨‹æ± ä½œç”¨ï¼š`å¸®åŠ©ä½ è½»æ¾ç®¡ç†çº¿ç¨‹ï¼Œåè°ƒä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹

`çº¿ç¨‹æ± å®ç°ï¼š`

1. åœ¨Springä¸­ï¼Œå¯ä»¥ç”¨ ThreadPoolTaskExecutor ï¼Œé…åˆ @Async æ³¨è§£æ¥å®ç°ï¼ˆä¸å¤ªå»ºè®®ï¼‰
2. åœ¨Javaä¸­ï¼Œå¯ä»¥ä½¿ç”¨ JUC å¹¶å‘ç¼–ç¨‹åŒ…ä¸­çš„ ThreadPoolExecutor æ¥å®ç°éå¸¸çµæ´»åœ°è‡ªå®šä¹‰çº¿ç¨‹æ± 

`çº¿ç¨‹æ± å‚æ•°ï¼š`

```java
public ThreadPoolExecutor(int corePoolSize,
                          int maximumPoolSize,
                          long keepAliveTime,
                          TimeUnit unit,
                          BlockingQueue<Runnable> workQueue,
                          ThreadFactory threadFactory,
                          RejectedExecutionHandler handler) 
```

corePoolSizeï¼ˆæ ¸å¿ƒçº¿ç¨‹æ•° ï¼‰ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿåº”è¯¥èƒ½åŒæ—¶å·¥ä½œçš„çº¿ç¨‹æ•°ï¼ˆéšæ—¶å°±ç»ªçš„çŠ¶æ€ï¼‰
maximumPoolSizeï¼ˆæœ€å¤§çº¿ç¨‹æ•° ï¼‰ï¼šæé™æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„çº¿ç¨‹æ± æœ€å¤šæœ‰å¤šå°‘ä¸ªçº¿ç¨‹ï¼Ÿ
keepAliveTimeï¼ˆç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼‰ï¼šéæ ¸å¿ƒçº¿ç¨‹åœ¨æ²¡æœ‰ä»»åŠ¡çš„æƒ…å†µä¸‹ï¼Œè¿‡å¤šä¹…è¦åˆ é™¤ï¼ˆç†è§£ä¸ºå¼€é™¤ä¸´æ—¶å·¥ï¼‰ï¼Œä»è€Œé‡Šæ”¾æ— ç”¨çš„çº¿ç¨‹èµ„æºã€‚
TimeUnit unitï¼ˆç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´çš„å•ä½ï¼‰ï¼šåˆ†é’Ÿã€ç§’
workQueueï¼ˆå·¥ä½œé˜Ÿåˆ—ï¼‰ï¼šç”¨äºå­˜æ”¾ç»™çº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå­˜åœ¨ä¸€ä¸ªé˜Ÿåˆ—çš„é•¿åº¦ï¼ˆä¸€å®šè¦è®¾ç½®ï¼Œä¸è¦è¯´é˜Ÿåˆ—é•¿åº¦æ— é™ï¼Œå› ä¸ºä¹Ÿä¼šå ç”¨èµ„æºï¼‰
threadFactoryï¼ˆçº¿ç¨‹å·¥å‚ï¼‰ï¼šæ§åˆ¶æ¯ä¸ªçº¿ç¨‹çš„ç”Ÿæˆã€çº¿ç¨‹çš„å±æ€§ï¼ˆæ¯”å¦‚çº¿ç¨‹åï¼‰
RejectedExecutionHandlerï¼ˆæ‹’ç»ç­–ç•¥ï¼‰ï¼šä»»åŠ¡é˜Ÿåˆ—æ»¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬é‡‡å–ä»€ä¹ˆæªæ–½ï¼Œæ¯”å¦‚æŠ›å¼‚å¸¸ã€ä¸æŠ›å¼‚å¸¸ã€è‡ªå®šä¹‰ç­–ç•¥

èµ„æºéš”ç¦»ç­–ç•¥ï¼šæ¯”å¦‚é‡è¦çš„ä»»åŠ¡ï¼ˆVIP ä»»åŠ¡ï¼‰ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ™®é€šä»»åŠ¡ä¸€ä¸ªé˜Ÿåˆ—ï¼Œä¿è¯è¿™ä¸¤ä¸ªé˜Ÿåˆ—äº’ä¸å¹²æ‰°ã€‚

`çº¿ç¨‹æ± å·¥ä½œæœºåˆ¶`

1. åˆšå¼€å§‹æ²¡æœ‰ä»»ä½•çš„çº¿ç¨‹ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•çš„ä»»åŠ¡

![image-20231104144503719](assets/image-20231104144503719.png)

2. æ¥äº†ä¸€ä¸ªä»»åŠ¡ï¼Œå‘ç°æˆ‘ä»¬çš„å‘˜å·¥è¿˜æ²¡æœ‰è¾¾åˆ°æ­£å¼å‘˜å·¥æ•°ï¼ˆcorePoolSize = 2ï¼‰ï¼Œæ¥ä¸€ä¸ªå‘˜å·¥ç›´æ¥å¤„ç†è¿™ä¸ªä»»åŠ¡

![image-20231104144708541](assets/image-20231104144708541.png)

3. åˆæ¥äº†ä¸€ä¸ªä»»åŠ¡ï¼Œå‘ç°æˆ‘ä»¬çš„å‘˜å·¥è¿˜æ²¡æœ‰è¾¾åˆ°æ­£å¼å‘˜å·¥æ•°ï¼ˆcorePoolSize = 2ï¼‰ï¼Œå†æ¥ä¸€ä¸ªå‘˜å·¥ç›´æ¥å¤„ç†è¿™ä¸ªä»»åŠ¡

![image-20231104144914128](assets/image-20231104144914128.png)

4. åˆæ¥äº†ä¸€ä¸ªä»»åŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬æ­£å¼å‘˜å·¥æ•°å·²ç»æ»¡äº†ï¼ˆå½“å‰çº¿ç¨‹æ•° = corePoolSize = 2ï¼‰ï¼Œä»»åŠ¡æ”¾åˆ°é˜Ÿåˆ—ï¼ˆæœ€å¤§é•¿åº¦ workQueue.size = 2ï¼‰é‡Œç­‰å¾…ï¼Œè€Œä¸æ˜¯å†åŠ æ–°å‘˜å·¥ã€‚

![image-20231104145032949](assets/image-20231104145032949.png)

5. åˆæ¥äº†ä¸€ä¸ªä»»åŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ä»»åŠ¡é˜Ÿåˆ—å·²ç»æ»¡äº†ï¼ˆå½“å‰çº¿ç¨‹æ•° > corePoolSize = 2ï¼Œå·²æœ‰ä»»åŠ¡æ•° = æœ€å¤§é•¿åº¦ workQueue.size = 2ï¼‰ï¼Œæ–°å¢çº¿ç¨‹ï¼ˆmaximumPoolSize = 4ï¼‰æ¥å¤„ç†æ–°ä»»åŠ¡ï¼Œè€Œä¸æ˜¯ä¸¢å¼ƒä»»åŠ¡

![image-20231104145154625](assets/image-20231104145154625.png)

6. å·²ç»åˆ°äº†ä»»åŠ¡ 7ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ä»»åŠ¡é˜Ÿåˆ—å·²ç»æ»¡äº†ã€ä¸´æ—¶å·¥ä¹Ÿæ‹›æ»¡äº†ï¼ˆå½“å‰çº¿ç¨‹æ•° = maximumPoolSize = 4ï¼Œå·²æœ‰ä»»åŠ¡æ•° = æœ€å¤§é•¿åº¦ workQueue.size = 2ï¼‰ï¼Œè°ƒç”¨ RejectedExecutionHandler æ‹’ç»ç­–ç•¥æ¥å¤„ç†å¤šä½™çš„ä»»åŠ¡ã€‚

![image-20231104145250349](assets/image-20231104145250349.png)

7. å¦‚æœå½“å‰çº¿ç¨‹æ•°è¶…è¿‡ corePoolSizeï¼ˆæ­£å¼å‘˜å·¥æ•°ï¼‰ï¼Œåˆæ²¡æœ‰æ–°çš„ä»»åŠ¡ç»™ä»–ï¼Œé‚£ä¹ˆç­‰ keepAliveTime æ—¶é—´è¾¾åˆ°åï¼Œå°±å¯ä»¥æŠŠè¿™ä¸ªçº¿ç¨‹é‡Šæ”¾ã€‚

`çº¿ç¨‹æ± å‚æ•°å¦‚ä½•è®¾ç½®ï¼Ÿ`

ç»“åˆå®é™…æƒ…å†µï¼ˆå®é™…ä¸šåŠ¡åœºæ™¯å’Œç³»ç»Ÿèµ„æºï¼‰æ¥æµ‹è¯•è°ƒæ•´ï¼Œä¸æ–­ä¼˜åŒ–ã€‚ 

å›å½’åˆ°æˆ‘ä»¬çš„ä¸šåŠ¡ï¼Œè¦è€ƒè™‘ç³»ç»Ÿæœ€è„†å¼±çš„ç¯èŠ‚ï¼ˆæœ¨æ¡¶æ•ˆåº”ï¼‰åœ¨å“ªï¼Ÿ

ç°æœ‰æ¡ä»¶ï¼šå‡è®¾AIèƒ½åŠ›çš„å¹¶å‘æ˜¯åªå…è®¸ 4 ä¸ªçº¿ç¨‹åŒæ—¶å»æ‰§è¡Œï¼Œåªå…è®¸20ä¸ªä»»åŠ¡æ’é˜Ÿ

corePoolSizeï¼ˆæ ¸å¿ƒçº¿ç¨‹æ•° => æ­£å¼å‘˜å·¥æ•°ï¼‰ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œå¯ä»¥è®¾ç½®ä¸º 2 - 4 
maximumPoolSizeï¼šè®¾ç½®ä¸ºæé™æƒ…å†µï¼Œè®¾ç½®ä¸º <= 4
keepAliveTimeï¼ˆç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼‰ï¼šä¸€èˆ¬è®¾ç½®ä¸ºç§’çº§æˆ–è€…åˆ†é’Ÿçº§
TimeUnit unitï¼ˆç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´çš„å•ä½ï¼‰ï¼šåˆ†é’Ÿã€ç§’
workQueueï¼ˆå·¥ä½œé˜Ÿåˆ—ï¼‰ï¼šç»“åˆå®é™…è¯·å†µå»è®¾ç½®ï¼Œå¯ä»¥è®¾ç½®ä¸º 20
threadFactoryï¼ˆçº¿ç¨‹å·¥å‚ï¼‰ï¼šæ§åˆ¶æ¯ä¸ªçº¿ç¨‹çš„ç”Ÿæˆã€çº¿ç¨‹çš„å±æ€§ï¼ˆæ¯”å¦‚çº¿ç¨‹åï¼‰
RejectedExecutionHandlerï¼ˆæ‹’ç»ç­–ç•¥ï¼‰ï¼šæŠ›å¼‚å¸¸ï¼Œæ ‡è®°æ•°æ®åº“çš„ä»»åŠ¡çŠ¶æ€ä¸º â€œä»»åŠ¡æ»¡äº†å·²æ‹’ç»â€

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä»»åŠ¡åˆ†ä¸º IO å¯†é›†å‹å’Œè®¡ç®—å¯†é›†å‹ä¸¤ç§ã€‚
è®¡ç®—å¯†é›†å‹ï¼šåƒ CPUï¼Œæ¯”å¦‚éŸ³è§†é¢‘å¤„ç†ã€å›¾åƒå¤„ç†ã€æ•°å­¦è®¡ç®—ç­‰ï¼Œä¸€èˆ¬æ˜¯è®¾ç½® corePoolSize ä¸º CPU çš„æ ¸æ•° + 1ï¼ˆç©ºä½™çº¿ç¨‹ï¼‰ï¼Œå¯ä»¥è®©æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½åˆ©ç”¨å¥½ CPU çš„æ¯ä¸ªæ ¸ï¼Œè€Œä¸”çº¿ç¨‹ä¹‹é—´ä¸ç”¨é¢‘ç¹åˆ‡æ¢ï¼ˆå‡å°‘æ‰“æ¶ã€å‡å°‘å¼€é”€ï¼‰
IO å¯†é›†å‹ï¼šåƒå¸¦å®½/å†…å­˜/ç¡¬ç›˜çš„è¯»å†™èµ„æºï¼ŒcorePoolSize å¯ä»¥è®¾ç½®å¤§ä¸€ç‚¹ï¼Œä¸€èˆ¬ç»éªŒå€¼æ˜¯ 2n å·¦å³ï¼Œä½†æ˜¯å»ºè®®ä»¥ IO çš„èƒ½åŠ›ä¸ºä¸»ã€‚

è€ƒè™‘å¯¼å…¥ç™¾ä¸‡æ•°æ®åˆ°æ•°æ®åº“ï¼Œå±äº IO å¯†é›†å‹ä»»åŠ¡ã€è¿˜æ˜¯è®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Ÿ

`è‡ªå®šä¹‰çº¿ç¨‹æ± `

```java
@Configuration
public class ThreadPoolExecutorConfig {


    @Bean
    public ThreadPoolExecutor threadPoolExecutor() {
        ThreadFactory threadFactory = new ThreadFactory() {
            private int count = 1;

            @Override
            public Thread newThread(@NotNull Runnable r) {
                Thread thread = new Thread(r);
                thread.setName("çº¿ç¨‹" + count);
                count++;
                return thread;
            }
        };
        return new ThreadPoolExecutor(2, 4, 100, TimeUnit.SECONDS,
                new ArrayBlockingQueue<>(4), threadFactory, new ThreadPoolExecutor.AbortPolicy());
    }
}
```

`æäº¤ä»»åŠ¡&æŸ¥çœ‹çº¿ç¨‹æ± ä¿¡æ¯`

```java
/**
 * ä»»åŠ¡é˜Ÿåˆ—æ¨¡æ‹Ÿ
 */
@RestController
@RequestMapping("/queue")
@Slf4j
@Profile({"dev","local"})
public class QueueController {
    @Resource
    private ThreadPoolExecutor threadPoolExecutor;
    
    //æäº¤ä»»åŠ¡
    @GetMapping("/add")
    public void add(String name) {
        CompletableFuture.runAsync(() -> {
            System.out.println("ä»»åŠ¡æ‰§è¡Œä¸­ï¼š" + name+",æ‰§è¡Œäººï¼š"+Thread.currentThread().getName());
            try {
                Thread.sleep(600000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }, threadPoolExecutor);
    }
    
    //æŸ¥çœ‹çº¿ç¨‹æ± ä¿¡æ¯
    @GetMapping("/get")
    public Map<String, Object> get(){
        Map<String,Object> map = new HashMap<>();
        int size = threadPoolExecutor.getQueue().size();
        long taskCount = threadPoolExecutor.getTaskCount();
        long completedTaskCount = threadPoolExecutor.getCompletedTaskCount();
        long activeCount = threadPoolExecutor.getActiveCount();
        map.put("é˜Ÿåˆ—é•¿åº¦",size);
        map.put("ä»»åŠ¡æ€»æ•°",taskCount);
        map.put("å·²æˆåŠŸæ‰§è¡Œçš„ä»»åŠ¡æ•°",taskCount);
        map.put("æ­£åœ¨å·¥ä½œçš„çº¿ç¨‹æ•°",activeCount);
        return map;
    }
}
```

ä½¿ç”¨æ¥å£æ–‡æ¡£æäº¤ä»»åŠ¡&æŸ¥çœ‹çº¿ç¨‹æ± ä¿¡æ¯æ¥ç†è§£çº¿ç¨‹æ± çš„å·¥ä½œæœºåˆ¶

##### å¼€å‘

`å®ç°å·¥ä½œæµç¨‹`

1. ç»™chartè¡¨æ–°å¢ä»»åŠ¡çŠ¶æ€å­—æ®µï¼ˆæ¯”å¦‚æ’é˜Ÿä¸­ï¼Œå·²å®Œæˆï¼Œæ‰§è¡Œä¸­ï¼Œå¤±è´¥ï¼‰ã€æ‰§è¡Œä¿¡æ¯å­—æ®µï¼ˆå¯ä»¥è®°å½•ä»»åŠ¡å¤±è´¥çš„åŸå› ç­‰ï¼‰

```sql
create table if not exists chart
(
    id          bigint auto_increment comment 'id' primary key,
    goal        text                                   null comment 'åˆ†æç›®æ ‡',
    rawData     text                                   null comment 'åŸå§‹æ•°æ®',
    chartType   varchar(128)                           null comment 'å›¾è¡¨ç±»å‹',
    chartName   varchar(128)                           null comment 'å›¾è¡¨åç§°',
    genChart    text                                   null comment 'AIç”Ÿæˆçš„å›¾è¡¨æ•°æ®',
    genSummary  text                                   null comment 'AIç”Ÿæˆçš„åˆ†ææ€»ç»“',
    userId      bigint                                 null comment 'åˆ›å»ºäººid',
    status      varchar(128) default 'wait'            not null comment 'wait,succeeded,failed,running',
    execMessage text                                   null comment 'æ‰§è¡Œä¿¡æ¯',
    createTime  datetime     default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    updateTime  datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    isDelete    tinyint      default 0                 not null comment 'æ˜¯å¦åˆ é™¤'
) comment 'å›¾è¡¨ä¿¡æ¯' collate = utf8mb4_unicode_ci;
```

2. ç”¨æˆ·ç‚¹å‡»æ™ºèƒ½åˆ†æé¡µçš„æäº¤æŒ‰é’®ï¼Œå…ˆæŠŠå›¾è¡¨ç«‹åˆ»ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œç„¶åæäº¤ä»»åŠ¡

3. ä»»åŠ¡ï¼šå…ˆä¿®æ”¹å›¾è¡¨çš„ä»»åŠ¡çŠ¶æ€ä¸ºâ€œæ‰§è¡Œä¸­â€ï¼›ç­‰æ‰§è¡ŒæˆåŠŸåï¼Œä¿®æ”¹ä¸ºâ€œå·²å®Œæˆâ€ï¼Œä¿å­˜æ‰§è¡Œç»“æœï¼›æ‰§è¡Œå¤±è´¥åï¼Œä¿®æ”¹ä¸ºå¤±è´¥ï¼Œè®°å½•å¤±è´¥ä¿¡æ¯

```java
/**
 * æ™ºèƒ½åˆ†æï¼ˆå¼‚æ­¥ï¼‰
 *
 * @param multipartFile
 * @param genChartRequest
 * @param request
 * @return
 */
@PostMapping("/gen")
public BaseResponse<BIResponse> genChartByAI(@RequestPart("file") MultipartFile multipartFile,
                                             GenChartRequest genChartRequest, HttpServletRequest request) {
    String goal = genChartRequest.getGoal();
    String chartType = genChartRequest.getChartType();
    String chartName = genChartRequest.getChartName();
    // æ‹¼æ¥åˆ†æç›®æ ‡
    if (StringUtils.isNotBlank(chartType)) {
        goal = goal + "ï¼Œè¯·ä½¿ç”¨" + chartType;
    }
    // æ ¡éªŒå‚æ•°
    ThrowUtils.throwIf(StringUtils.isBlank(goal), ErrorCode.PARAMS_ERROR, "åˆ†æç›®æ ‡ä¸ºç©º");
    ThrowUtils.throwIf(StringUtils.isNotBlank(chartName) && chartName.length() > 128, ErrorCode.PARAMS_ERROR, "å›¾è¡¨åç§°è¿‡é•¿");
    // æ ¡éªŒæ–‡ä»¶
    long size = multipartFile.getSize();
    String originalFilename = multipartFile.getOriginalFilename();
    // æ ¡éªŒæ–‡ä»¶å¤§å°
    final long ONE_MB = 1024 * 1024L;
    ThrowUtils.throwIf(size > ONE_MB, ErrorCode.PARAMS_ERROR, "æ–‡ä»¶å¤§å°è¶…è¿‡ 1M");
    // æ ¡éªŒæ–‡ä»¶åç¼€
    String suffix = FileUtil.getSuffix(originalFilename);
    final List<String> validFileSuffix = Arrays.asList("xlsx");
    ThrowUtils.throwIf(!validFileSuffix.contains(suffix), ErrorCode.PARAMS_ERROR, "æ–‡ä»¶åç¼€ä¸ç¬¦åˆè¦æ±‚");
    // è·å–ç™»å½•ç”¨æˆ·
    User loginUser = userService.getLoginUser(request);
    // é™æµ,æ¯ä¸ªç”¨æˆ·ä¸€ä¸ªé™æµå™¨
    redisLimiterManager.doRateLimit("genChartByAI_" + loginUser.getId().toString());
    // å‹ç¼©åŸå§‹æ•°æ®
    String data = ExcelUtils.excelToCsv(multipartFile);
    // æ„é€ ç”¨æˆ·è¯·æ±‚ï¼ˆåˆ†æç›®æ ‡ï¼Œå›¾è¡¨åç§°ï¼Œå›¾è¡¨ç±»å‹ï¼Œcsvæ•°æ®ï¼‰
    StringBuilder userInput = new StringBuilder();
    userInput.append("åˆ†æéœ€æ±‚ï¼š").append("\n");
    userInput.append(goal).append("\n");
    userInput.append("åŸå§‹æ•°æ®ï¼š").append("\n");
    userInput.append(data).append("\n");
    // æ’å…¥æ•°æ®åº“
    Chart chart = new Chart();
    chart.setGoal(goal);
    chart.setRawData(data);
    chart.setChartType(chartType);
    chart.setChartName(chartName);
    chart.setUserId(loginUser.getId());
    chart.setStatus("wait");
    boolean save = chartService.save(chart);
    ThrowUtils.throwIf(!save, ErrorCode.SYSTEM_ERROR, "å›¾è¡¨ä¿å­˜å¤±è´¥");
    //todo å¤„ç†ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†åï¼ŒæŠ›å¼‚å¸¸çš„æƒ…å†µ
    CompletableFuture.runAsync(() -> {
        //å…ˆä¿®æ”¹å›¾è¡¨çš„ä»»åŠ¡çŠ¶æ€ä¸ºâ€œæ‰§è¡Œä¸­â€ï¼›ç­‰æ‰§è¡ŒæˆåŠŸåï¼Œä¿®æ”¹ä¸ºâ€œå·²å®Œæˆâ€ï¼Œä¿å­˜æ‰§è¡Œç»“æœï¼›æ‰§è¡Œå¤±è´¥åï¼Œä¿®æ”¹ä¸ºå¤±è´¥ï¼Œè®°å½•å¤±è´¥ä¿¡æ¯
        //ä¿®æ”¹ä»»åŠ¡çŠ¶æ€ä¸ºæ‰§è¡Œä¸­ï¼Œå‡å°‘é‡å¤æ‰§è¡Œçš„é£é™©ã€åŒæ—¶è®©ç”¨æˆ·çŸ¥æ™“æ‰§è¡ŒçŠ¶æ€
        Chart updateChart = new Chart();
        updateChart.setId(chart.getId());
        updateChart.setStatus("running");
        boolean result = chartService.updateById(updateChart);
        if (!result) {
            handleChartUpdateError(chart.getId(),"æ›´æ–°å›¾è¡¨æ‰§è¡Œä¸­çŠ¶æ€å¤±è´¥");
            return;
        }
        // è°ƒç”¨é±¼èªæ˜SDKï¼Œå¾—åˆ°å“åº”
        long biModelId = 1719916921023344642L;
        String answer = aiManager.doChat(biModelId, userInput.toString());
        // ä»AIå“åº”ç»“æœä¸­ï¼Œå–å‡ºéœ€è¦çš„æ•°æ®
        String[] splits = answer.split("ã€ã€ã€ã€ã€");
        if (splits.length < 3) {
            handleChartUpdateError(chart.getId(),"AIç”Ÿæˆé”™è¯¯");
            return;
        }
        String genChart = splits[1].trim();
        String genSummary = splits[2].trim();
        //æ‰§è¡ŒæˆåŠŸ
        Chart updateChartResult = new Chart();
        updateChartResult.setId(chart.getId());
        //todo å»ºè®®å®šä¹‰çŠ¶æ€ä¸ºæšä¸¾å€¼
        updateChartResult.setStatus("succeeded");
        updateChartResult.setGenChart(genChart);
        updateChartResult.setGenSummary(genSummary);
        result = chartService.updateById(updateChartResult);
        if (!result) {
            handleChartUpdateError(chart.getId(),"æ›´æ–°å›¾è¡¨å·²å®ŒæˆçŠ¶æ€å¤±è´¥");
            return;
        }
    },threadPoolExecutor);
    // è¿”å›ç»™å‰ç«¯
    BIResponse biResponse = new BIResponse();
    biResponse.setChartId(chart.getId());
    return ResultUtils.success(biResponse);
}
private void handleChartUpdateError(long chartId, String execMessage) {
    Chart updateChart = new Chart();
    updateChart.setId(chartId);
    updateChart.setStatus("failed");
    updateChart.setExecMessage(execMessage);
    boolean result = chartService.updateById(updateChart);
    if (!result) {
        log.error("æ›´æ–°å›¾è¡¨å¤±è´¥çŠ¶æ€å¤±è´¥ï¼Œ" + chartId + "ï¼Œ" + execMessage);
    }
}
```

4. ç”¨æˆ·å¯ä»¥åœ¨ä¸ªäººå›¾è¡¨é¡µé¢æŸ¥çœ‹æ‰€æœ‰å›¾è¡¨ï¼ˆå·²ç”Ÿæˆï¼Œç”Ÿæˆä¸­ï¼Œç”Ÿæˆå¤±è´¥ï¼‰çš„ä¿¡æ¯å’ŒçŠ¶æ€ï¼ˆä¿®æ”¹ä¸ªäººå›¾è¡¨é¡µé¢ï¼‰

5. ç”¨æˆ·å¯ä»¥ä¿®æ”¹ç”Ÿæˆå¤±è´¥çš„å›¾è¡¨ä¿¡æ¯ï¼Œç„¶åç‚¹å‡»é‡æ–°ç”Ÿæˆï¼ˆæš‚æœªå®Œæˆï¼‰

##### ä¼˜åŒ–ç‚¹

1. guava retrying é‡è¯•
2. æå‰è€ƒè™‘åˆ°AIç”Ÿæˆé”™è¯¯çš„æƒ…å†µï¼Œåœ¨åç«¯è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼ˆæ¯”å¦‚AIç”Ÿæˆäº†å¤šä½™çš„å†…å®¹ï¼Œæå–æ­£ç¡®çš„å†…å®¹ï¼‰
3. å¦‚æœè¯´ä»»åŠ¡æ ¹æœ¬æ²¡æäº¤åˆ°é˜Ÿåˆ—ä¸­ï¼ˆæˆ–è€…é˜Ÿåˆ—æ»¡äº†ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å®šæ—¶ä»»åŠ¡æŠŠå¤±è´¥çŠ¶æ€çš„å›¾è¡¨æ”¾åˆ°é˜Ÿåˆ—ä¸­	
4. å»ºè®®ç»™ä»»åŠ¡çš„æ‰§è¡Œå¢åŠ ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œè¶…æ—¶åè‡ªåŠ¨æ ‡è®°ä¸ºå¤±è´¥ 
5. åå‘å‹åŠ›https://zhuanlan.zhihu.com/p/404993753 åˆ¤æ–­ç¬¬ä¸‰æ–¹æœåŠ¡çš„çŠ¶æ€æ¥é€‰æ‹©å½“å‰ç³»ç»Ÿçš„ç­–ç•¥ï¼ˆæ¯”å¦‚æ ¹æ®AIæœåŠ¡çš„å½“å‰ä»»åŠ¡é˜Ÿåˆ—æ¥æ§åˆ¶æˆ‘ä»¬ç³»ç»Ÿçš„æ ¸å¿ƒçº¿ç¨‹æ•°ï¼‰ï¼Œæœ€å¤§åŒ–åˆ©ç”¨ç³»ç»Ÿèµ„æº
6. ä¸ªäººå›¾è¡¨é¡µé¢å¢åŠ ä¸€ä¸ªåˆ·æ–°æŒ‰é’®æˆ–å®šæ—¶è‡ªåŠ¨åˆ·æ–°ï¼Œä¿è¯è·å–åˆ°å›¾è¡¨çš„æœ€æ–°çŠ¶æ€ï¼ˆå‰ç«¯è½®è¯¢ï¼‰
7. ä»»åŠ¡æ‰§è¡ŒæˆåŠŸæˆ–å¤±è´¥ç»™ç”¨æˆ·å‘é€æ¶ˆæ¯é€šçŸ¥

## å‰ç«¯

### è‡ªåŠ¨ç”Ÿæˆåç«¯è°ƒç”¨ä»£ç 

![image-20231031161114725](assets/image-20231031161114725.png)

![image-20231031161044255](assets/image-20231031161044255.png)

![image-20231031161225991](assets/image-20231031161225991.png)

![image-20231031160739020](assets/image-20231031160739020.png)

### ä¿®æ”¹requestErrorConfig

![image-20231101104428242](assets/image-20231101104428242.png)

![image-20231101104452851](assets/image-20231101104452851.png)

![image-20231101105205945](assets/image-20231101105205945.png)

![image-20231101105346669](assets/image-20231101105346669.png)

![image-20231101105418575](assets/image-20231101105418575.png)

### ç™»å½•æ³¨å†Œé¡µé¢

#### ç™»å½•é¡µé¢

1. **ä¿®æ”¹é¡µé¢**

![image-20231101093859849](assets/image-20231101093859849.png)

![image-20231101094604170](assets/image-20231101094604170.png)

![image-20231101094805356](assets/image-20231101094805356.png)

![image-20231101095024190](assets/image-20231101095024190.png)

![image-20231101095351698](assets/image-20231101095351698.png)

![image-20231101095905454](assets/image-20231101095905454.png)

![image-20231101100628266](assets/image-20231101100628266.png)

![image-20231101100753049](assets/image-20231101100753049.png)

![image-20231101100921671](assets/image-20231101100921671.png)

![image-20231101102635469](assets/image-20231101102635469.png)

![image-20231101102712922](assets/image-20231101102712922.png)

![image-20231101111107730](assets/image-20231101111107730.png)

2. **å‘åç«¯å‘èµ·ç™»å½•è¯·æ±‚**

![image-20231101101745533](assets/image-20231101101745533.png)

[åœ¨ant-designä¸­å¦‚ä½•åˆ©ç”¨ä»£ç è‡ªåŠ¨åˆ·æ–°å½“å‰é¡µé¢_antd proä¸­é¡µé¢åˆ·æ–°çš„api-CSDNåšå®¢](https://blog.csdn.net/qq_40372395/article/details/80893453)

![image-20231101141243964](assets/image-20231101141243964.png)

![image-20231101105748685](assets/image-20231101105748685.png)

3. **ä¿®æ”¹app.tsxæ–‡ä»¶**

![image-20231101110537183](assets/image-20231101110537183.png)

![image-20231101110613918](assets/image-20231101110613918.png)

![image-20231101111152663](assets/image-20231101111152663.png)

![image-20231101134723132](assets/image-20231101134723132.png)

#### æ³¨å†Œé¡µé¢

å¤åˆ¶ç™»é™†é¡µé¢ä¿®æ”¹ï¼Œå†æ·»åŠ æ³¨å†Œé¡µé¢çš„è·¯ç”±

![image-20231101134403032](assets/image-20231101134403032.png)

![image-20231101134739225](assets/image-20231101134739225.png)

#### é€€å‡ºç™»å½•

![image-20231101140309845](assets/image-20231101140309845.png)

![image-20231101141545088](assets/image-20231101141545088.png)

![image-20231101140401063](assets/image-20231101140401063.png)

![image-20231101140432402](assets/image-20231101140432402.png)

![image-20231101140559979](assets/image-20231101140559979.png)

### æ™ºèƒ½å›¾è¡¨åˆ†æé¡µé¢

1. ç”¨æˆ·è¾“å…¥
   1. åˆ†æç›®æ ‡
   2. ä¸Šä¼ åŸå§‹æ•°æ®ï¼ˆexcelï¼‰
   3. æ›´ç²¾ç»†åŒ–çš„æ§åˆ¶å›¾è¡¨ï¼šæ¯”å¦‚å›¾è¡¨ç±»å‹ï¼Œå›¾è¡¨åç§°ç­‰
2. å±•ç¤º
   1. å±•ç¤ºä»åç«¯è·å¾—çš„å›¾è¡¨å’Œç»“è®º

**1ã€è‡ªåŠ¨ç”Ÿæˆåç«¯è°ƒç”¨ä»£ç **

**2ã€åˆ›å»ºé¡µé¢**

![image-20231103152845702](assets/image-20231103152845702.png)

**3ã€æ·»åŠ è·¯ç”±**

![image-20231103153006971](assets/image-20231103153006971.png)

**4ã€ç”¨æˆ·è¾“å…¥**

1. é€‰æ‹©ç»„ä»¶

![image-20231103145354640](assets/image-20231103145354640.png)

![image-20231103145455990](assets/image-20231103145455990.png)

![image-20231103145518854](assets/image-20231103145518854.png)

2. å¼•å…¥ç»„ä»¶

![image-20231103181144202](assets/image-20231103181144202.png)

![image-20231102203513905](assets/image-20231102203513905.png)

![image-20231102203553926](assets/image-20231102203553926.png)

![image-20231102203626446](assets/image-20231102203626446.png)

![image-20231102203701102](assets/image-20231102203701102.png)

![image-20231102203751293](assets/image-20231102203751293.png)

**4ã€å›¾è¡¨å±•ç¤º** https://github.com/hustcc/echarts-for-react  https://git.hust.cc/echarts-for-react/

![image-20231102203834196](assets/image-20231102203834196.png)

![image-20231102202549740](assets/image-20231102202549740.png)

### ä¸ªäººå›¾è¡¨é¡µé¢

**1.åˆ›å»ºé¡µé¢**

![image-20231103155522380](assets/image-20231103155522380.png)

**2ã€æ·»åŠ è·¯ç”±**

![image-20231103153629589](assets/image-20231103153629589.png)

**3ã€è·å–æ•°æ®ï¼Œå®šä¹‰ state å˜é‡æ¥å­˜å‚¨æ•°æ®ï¼Œç”¨äºç»™é¡µé¢å±•ç¤º**

![image-20231103172437291](assets/image-20231103172437291.png)

![image-20231103162350923](assets/image-20231103162350923.png)

![image-20231104131721650](assets/image-20231104131721650.png)

![image-20231103161951719](assets/image-20231103161951719.png)

**4ã€é€‰æ‹©ç»„ä»¶**

![image-20231103162714889](assets/image-20231103162714889.png)

**5ã€å¼•å…¥ç»„ä»¶**

![image-20231103172159876](assets/image-20231103172159876.png)

![image-20231103172331765](assets/image-20231103172331765.png)

![image-20231103173125126](assets/image-20231103173125126.png)

**6ã€æ·»åŠ åˆ†é¡µ**

![image-20231103174145626](assets/image-20231103174145626.png)

**7ã€æ·»åŠ æœç´¢æ¡†**

![image-20231103175128062](assets/image-20231103175128062.png)

![image-20231103175103464](assets/image-20231103175103464.png)

**8ã€è®¾ç½®loading**

![image-20231103180537559](assets/image-20231103180537559.png)

![image-20231103180521767](assets/image-20231103180521767.png)

![image-20231103180604913](assets/image-20231103180604913.png)

![image-20231103180620196](assets/image-20231103180620196.png)

**9ã€åŸå­åŒ–æ ·å¼**

![image-20231103180738768](assets/image-20231103180738768.png)

![image-20231103180802775](assets/image-20231103180802775.png)

**10ã€å±•ç¤º**

![image-20231103181323718](assets/image-20231103181323718.png)

**11ã€æ‰©å±•ç‚¹**

æ”¯æŒç”¨æˆ·æŸ¥çœ‹åŸå§‹æ•°æ®

æ”¯æŒè·³è½¬åˆ°iå›¾è¡¨ç¼–è¾‘é¡µï¼Œå»ç¼–è¾‘å›¾è¡¨

**12ã€ä¿®æ”¹é¡µé¢ï¼Œè¡¥å……é”™è¯¯å¤„ç†**

![image-20231104171643817](assets/image-20231104171643817.png)

![image-20231104171524857](assets/image-20231104171524857.png)

![image-20231104171553609](assets/image-20231104171553609.png)

![image-20231104172425764](assets/image-20231104172425764.png)

![image-20231104172450541](assets/image-20231104172450541.png)

![image-20231104172205864](assets/image-20231104172205864.png)

![image-20231104172216748](assets/image-20231104172216748.png)

### æ™ºèƒ½å›¾è¡¨å¼‚æ­¥åˆ†æé¡µé¢

**æ·»åŠ è·¯ç”±**

![image-20231104172713809](assets/image-20231104172713809.png)

**åˆ›å»ºé¡µé¢**

![image-20231104164128546](assets/image-20231104164128546.png)

**ä¿®æ”¹é¡µé¢**

![image-20231104164254448](assets/image-20231104164254448.png)

![image-20231104164327356](assets/image-20231104164327356.png)

![image-20231104165742419](assets/image-20231104165742419.png)

![image-20231104165822210](assets/image-20231104165822210.png)

![image-20231104165837769](assets/image-20231104165837769.png)

## Ant Design Proè¸©å‘

1. é¡µé¢å¦‚æœä¸€ç›´åŠ è½½ï¼Œåˆ æ‰no de_modulesï¼Œé‡æ–°å®‰è£…ä¾èµ–

2. nodejsç‰ˆæœ¬å»ºè®®16

3. æƒé™ä¸å¤Ÿå°±åˆ‡ç®¡ç†å‘˜

4. æäº¤ä»£ç 

   ```
   git commit --no-verify -m 'your message'
   ```


## Windowså‘½ä»¤

```sh
#æŸ¥çœ‹Windows Hyper-V è™šæ‹ŸåŒ–å¹³å°å ç”¨äº†å“ªäº›èŒƒå›´å†…çš„ç«¯å£
netsh interface ipv4 show excludedportrange protocol=tcp
```

![image-20231031202852991](assets/image-20231031202852991.png)
